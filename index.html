<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Football TCG</title>
  <link rel="icon" type="image/png" href="images/Logo.png">
  <style>
    :root{
      --card-w: 130px;
      --card-h: 185px;
    }

    @property --x { syntax: '<number>'; initial-value: 0; inherits: true; }
    @property --y { syntax: '<number>'; initial-value: 0; inherits: true; }


    @property --rotate {
      syntax: "<angle>";
      initial-value: 132deg;
      inherits: false;
    }

    @keyframes spin {
      0% {
        --rotate: 0deg;
      }
      100% {
        --rotate: 360deg;
      }
    }


    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      color: white;
      padding: 20px;

      /* --- Propiedades para la imagen de fondo --- */
      background-color: #111217; /* Color de respaldo si la imagen no carga */
      background-image: url('images/fondo.jpg'); /* Ruta a tu imagen */
      background-size: cover; /* Asegura que la imagen cubra todo el espacio sin deformarse */
      background-position: center center; /* Centra la imagen horizontal y verticalmente */
      background-repeat: no-repeat; /* Evita que la imagen se repita si es pequeña */
      background-attachment: fixed; /* Fija la imagen para que no se mueva al hacer scroll */
    }

    .card.tilting {
      transition: transform 0.05s ease-out; /* Transición rápida SÓLO al mover el ratón */
    }

    h1 {
      color: #eee;
      text-shadow: 0 0 10px rgba(31, 255, 7, 0.3);
    }
    #cards {
      position: relative;
      width: calc(var(--card-w) + 20px);
      height: var(--card-h);
      margin: 50px auto calc(var(--card-h) + 60px) auto;
      perspective: 1200px;
    }
    .card {
      width: var(--card-w);
      height: var(--card-h);
      perspective: 1000px;
      border-radius: 12px;
      position: absolute;
      top: 0;
      left: 0;
      transform-style: preserve-3d;
      transition: transform 0.7s ease, left 0.7s ease, top 0.7s ease, box-shadow 0.5s ease;
      cursor: pointer;
      user-select: none;
    }
    .card .side {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      overflow: hidden;
      padding: 10px;
      box-sizing: border-box;
    }
    .card .back {
      background-image: url('images/card-back.png');
      background-size: cover;
      background-position: center;
      background-color: #035700;
      transform: rotateY(0deg);
      font-size: 0; 
    }
    .card .front {
      transform:
      rotateY(180deg)
      rotateX(calc(var(--x) * 1deg))
      rotateY(calc(var(--y) * 1deg));
      transition: transform 0.2s ease;
      will-change: transform;
    }

    .card.flipped{ transform: rotateY(180deg); }

    .card.common { --rarity-color: #8a8a8a; }
    .card.rare { --rarity-color: #4a7dff; }
    .card.epic { --rarity-color: #a053de; }
    .card.legendary { --rarity-color: #ffc84a; }
    .card.relic { --rarity-color: #4af0e0; }

    /* 1. Sombra para la carta VOLTEADA (en la cara frontal) */
    .card.flipped .front {
      box-shadow: 0 0 7px 3px var(--rarity-color);
    }

/* 2. Sombra para la carta SIN VOLTEAR (en el contenedor) */
.card:not(.flipped) {
  box-shadow: 0 0 20px 5px var(--rarity-color);
}

.common .front { background: linear-gradient(170deg, #8a8a8a, #505050); }
.rare .front { background: linear-gradient(170deg, #4a7dff, #294eb0); }
.epic .front { background: linear-gradient(170deg, #a053de, #6a2b9e); }
.legendary .front { background: linear-gradient(170deg, #ffc84a, #d1921a); }
.relic .front { background: linear-gradient(170deg, #4af0e0, #1e9e8f); }

/* --- EFECTO DORADO METÁLICO REACTIVO --- */
.card.golden.flipped {
  position: relative;
  border: none;
  overflow: hidden;
  box-shadow: 0 0 15px 4px rgba(255, 215, 100, 0.4);
  transition: transform 0.05s ease-out, box-shadow 0.3s ease;
}

/* Capa metálica base */
.card.golden.flipped::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: -1;
  border-radius: 14px;
  background-image:
  radial-gradient(
    circle at calc(50% + var(--y) * 8%) calc(50% + var(--x) * 8%),
    rgba(255, 250, 220, 0.9) 0%,
    rgba(255, 220, 130, 0.7) 25%,
    rgba(180, 120, 20, 0.5) 60%,
    rgba(80, 50, 10, 0.25) 100%
  ),
  url('images/gold-texture.png');
  background-size: 100% 100%, cover;
  background-position: calc(50% + var(--y) * 1%) calc(50% + var(--x) * 1%);
  mix-blend-mode: color-dodge;
  filter: brightness(1.1) contrast(1.3);
  animation: gold-metal-shift 12s ease-in-out infinite alternate;
  will-change: background-position, filter;
}

/* Luz especular interior reactiva */
.card.golden .front::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 12px;
  z-index: 3;
  pointer-events: none;
  background: radial-gradient(
    circle at calc(50% + var(--y) * 15%) calc(50% + var(--x) * 15%),
    rgba(255, 250, 210, 0.35),
    rgba(255, 210, 100, 0.15) 30%,
    transparent 80%
  );
  mix-blend-mode: screen;
  will-change: background-position;
}

@keyframes gold-metal-shift {
  0% { filter: brightness(1.05) contrast(1.1); }
  50% { filter: brightness(1.25) contrast(1.3); }
  100% { filter: brightness(1.05) contrast(1.1); }
}


@keyframes foil-sweep {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes smooth-gold-shine {
  0% {
    opacity: 0.6;
    background-position: 0% 0%;
    filter: brightness(0.6) contrast(1.2);
  }
  50% {
    opacity: 0.75;
    background-position: 100% 100%;
    filter: brightness(0.75) contrast(1.5);
  }
  100% {
    opacity: 0.6;
    background-position: 0% 0%;
    filter: brightness(0.6) contrast(1.2);
  }
}

@keyframes holo-shine {
  0% { background-position: 100% 0%; }
  50% { background-position: 0% 100%; }
  100% { background-position: 100% 0%; }
}

@keyframes hue-cycle {
  from { filter: hue-rotate(0deg); }
  to { filter: hue-rotate(360deg); }
}

@keyframes breathe-negative {
  0%, 100% {
    filter: sepia(100%) brightness(125%) contrast(150%) saturate(105%) invert(100%);
  }
  50% {
    filter: sepia(100%) brightness(150%) contrast(180%) saturate(105%) invert(100%);
  }
}

/* --- EFECTO FOIL REACTIVO (CORREGIDO) --- */
.variant-foil .front::before {
  content: ''; position: absolute; inset: 0; z-index: 5; pointer-events: none;
  background-image: radial-gradient(ellipse at center,
    rgba(220, 230, 255, 0.33) 0%,
    rgba(220, 230, 255, 0.15) 20%,
    transparent 60%);
  background-size: 200% 200%;
  background-position: calc(50% + var(--y) * 8%) calc(50% + var(--x) * 8%);
  mix-blend-mode: color-dodge;
  opacity: 0; /* Por defecto invisible */
  transition: opacity 0.4s ease-out;
  will-change: background-position, opacity;
}
.card.variant-foil.tilting .front::before {
  opacity: 1; /* Hacemos visible el efecto al interactuar */
}

/* --- EFECTO HOLO REACTIVO --- */
.variant-holo .front::before {
  content: '';
  position: absolute; inset: 0; z-index: 5; pointer-events: none;
  background-image: url('images/holoeffect.png');
  background-size: cover;
  mask-image: radial-gradient(ellipse at center, white 25%, transparent 60%);
  mask-size: 200% 200%;
  mask-position: calc(50% + var(--y) * 8%) calc(50% + var(--x) * 8%);
  mix-blend-mode: overlay;
  opacity: 1;
  will-change: mask-position, opacity;
}

/* --- EFECTO POLI REACTIVO --- */
.variant-poli .front {
  filter: hue-rotate(calc(var(--y) * 10deg))
  saturate(calc(1.5 + var(--x) * 0.1))
  brightness(1.1);
}

/* --- EFECTO NEGATIVO REACTIVO (CORREGIDO Y SUTIL) --- */

/* 1. Define el estado BASE (estático) de la carta negativa */
.variant-negative .front {
  filter: invert(1) saturate(2) brightness(1);
  transition: filter 0.4s ease-out;
  will-change: filter;
}

/* 2. Define el estado ACTIVO (cuando el ratón está encima) */
.card.variant-negative.tilting .front {
  filter: invert(1)
  saturate(calc(2 + abs(var(--y)) * 0.5))
  /* AQUÍ ESTÁ EL CAMBIO: El brillo ahora es mucho más sutil */
  brightness(calc(1 + var(--x) * 0.02)) 
  hue-rotate(calc(var(--y) * 5deg));
}

.player-image {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; 
  border-radius: 10px; z-index: 1; opacity: 0.85;
}
.front::after {
  content: ''; position: absolute; inset: 0; border-radius: 10px;
  background: linear-gradient(to top, rgba(0,0,0,0.15) 0%, transparent 40%, transparent 60%, rgba(0,0,0,0.15) 100%);
  z-index: 2;
}

.card .front .player-info { z-index: 3; text-shadow: 0 1px 3px rgba(0,0,0,0.9); display: flex; flex-direction: column; position: relative; width: 100%; height: 100%; }

.player-rating {
  font-size: 18px; font-weight: 700; position: absolute;
  top: 4px; right: 8px; text-align: right;
}
.player-position {
  font-size: 10px; background: rgba(0,0,0,0.4); padding: 2px 5px; border-radius: 4px; position: absolute;
  top: 24px; right: 8px; text-align: right;
}

.card-indicators { position: absolute; top: 8px; left: 8px; z-index: 4; display: flex; gap: 4px; font-size: 12px; text-shadow: 0 1px 1px #000; }
.indicator { background: rgba(0,0,0,0.5); padding: 1px 5px; border-radius: 4px; }

#counter {
  margin-top: 40px;
  display: flex;
  flex-direction: column;
  gap: 15px; /* Espacio entre filas de rareza */
  max-width: 1300px;
  margin-left: auto;
  margin-right: auto;
}
.counter-row {
  display: grid;
  grid-template-columns: repeat(10, 1fr); /* 10 cajas por fila */
  gap: 8px;
}
.count-box{ background:#1d1f24; border-radius:8px; padding:8px; font-size:14px; text-align:center; box-shadow:0 0 8px rgba(0,0,0,0.5); }
.count-box span { font-weight: bold; }

button{ margin-top:20px; padding:12px 24px; border-radius:8px; border:none; background:#1f7; color:#022; font-weight:700; cursor:pointer; font-size: 16px; transition: transform 0.2s, box-shadow 0.2s; }
button:hover{ transform: scale(1.05); box-shadow: 0 0 15px rgba(31, 255, 7, 0.4); }

.button-container { 
  display: flex; 
  justify-content: center; 
  gap: 10px; 
  margin-top:20px; 
}
#showcaseBtn { 
  background-color: #3b68d1; 
  color: #fff; 
}
#showcaseBtn:hover { 
  box-shadow: 0 0 15px rgba(59, 104, 209, 0.6); 
}

#showcase-overlay {
  position: fixed; 
  inset: 0; 
  background: rgba(10, 12, 20, 0.95); 
  z-index: 100;
  display: none; 
  align-items: center; 
  justify-content: flex-start; 
  flex-direction: column;
  padding: 40px 20px; 
  overflow-y: auto;
}
#showcase-overlay.visible { 
  display: flex; 
}
#showcase-content {
  width: 100%; 
  max-width: 1600px; 
  display: flex; 
  flex-direction: column; 
  gap: 20px;
}
.showcase-row {
  background: rgba(255,255,255,0.03); 
  border-radius: 12px; 
  padding: 15px;
}
.showcase-row h2 {
  margin: 0 0 15px 0; 
  text-align: left; 
  text-transform: capitalize;
}
.showcase-grid {
  display: flex; 
  flex-wrap: wrap; 
  gap: 10px;
}
.showcase-card {
  width: var(--card-w); 
  height: var(--card-h);
  position: relative; 
  top: auto; 
  left: auto;
  cursor: default;
}
#closeShowcaseBtn {
  position: fixed; 
  top: 20px; 
  right: 20px;
  width: 40px; 
  height: 40px; 
  padding: 0; 
  font-size: 20px;
  background-color: #ff4d4d; 
  color: #fff;
}
#closeShowcaseBtn:hover { 
  box-shadow: 0 0 15px rgba(255, 77, 77, 0.6); 
}

.placeholder-name {
  position: absolute;
  bottom: 10px;
  left: 0;
  right: 0;
  font-weight: bold;
}

.showcase-grid {
  display: flex;
  flex-direction: column; /* Apilamos las entradas de jugadores verticalmente */
  gap: 20px;
}

.player-album-entry {
  background: rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}
.player-album-entry h3 {
  text-align: left;
  margin: 0 0 10px 5px;
  font-size: 16px;
  color: #ccc;
}

.variants-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.album-placeholder {
  background: rgba(0,0,0,0.2);
  border: 2px dashed #444;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #777;
  box-sizing: border-box;
  position: relative;
}


.placeholder-indicator {
  font-weight: bold;
  font-size: 14px;
  width: 75px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.placeholder-indicator.golden-indicator {
  color: #ffc84a;
  border-color: #ffc84a;
}

.duplicate-counter {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: 5px;
  z-index: 4;
  border: 1px solid #fff;
  text-shadow: 0 0 3px #000;
}

button:disabled {
  background-color: #555;
  color: #999;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

h1 img {
  height: 300px; 
  width: auto;
  filter: drop-shadow(0 0 10px rgba(0, 160, 250, 0.5));
}

</style>
</head>
<body>
  <audio id="flipSound" src="sounds/flip-sound.mp3" preload="auto"></audio>
  <audio id="buttonClickSound" src="sounds/button-click.mp3" preload="auto"></audio>
  <h1><img src="images/Logo.png" alt="Football TCG Logo"></h1>
  <div class="button-container">
    <button onclick="openPack()">Open Pack</button>
    <button id="showcaseBtn">My Album</button>
    <button onclick="resetCollection()" style="background-color: #E6A115; color: #fff;">Reset Progress</button>
  </div>
  <div id="cards"></div>
  <div id="showcase-overlay">
    <div id="showcase-content"></div>
    <button id="closeShowcaseBtn">X</button>
  </div>

  <script>
    const TEST_MODE_FILL_ALBUM = false; /*PRUEBA ALBUM LLENO*/
    const ALLOW_GOLDEN_CARDS = false; /*DESHABILITAR DORADAS*/
    const playersDB = [
    /* RELIC (12 Jugadores) */
    { id: 1, name: "Lionel Messi", position: "DEL", rating: 99, rarity: "relic", img: "images/lionelmessi.png" },/*DONE*/
    { id: 2, name: "Pelé", position: "DEL", rating: 98, rarity: "relic", img: "images/pele.png" },/*DONE*/
    { id: 3, name: "Diego Maradona", position: "MED", rating: 97, rarity: "relic", img: "images/diegomaradona.png" },/*DONE*/
    { id: 4, name: "Cristiano Ronaldo", position: "DEL", rating: 95, rarity: "relic", img: "images/cristianoronaldo.png" },/*DONE*/
    { id: 5, name: "Johan Cruyff", position: "MED", rating: 97, rarity: "relic", img: "images/johancruyff.png" },/*DONE*/
    { id: 6, name: "Zinedine Zidane", position: "MED", rating: 95, rarity: "relic", img: "images/zinedinezidane.png" },/*DONE*/
    { id: 7, name: "Ronaldo Nazário", position: "DEL", rating: 95, rarity: "relic", img: "images/ronaldonazario.png" },/*DONE*/
    { id: 8, name: "Ronaldinho", position: "MED", rating: 96, rarity: "relic", img: "images/ronaldinho.png" },/*DONE*/
    { id: 9, name: "Andrés Iniesta", position: "MED", rating: 95, rarity: "relic", img: "images/andresiniesta.png" },/*DONE*/
    { id: 10, name: "Xavi Hernández", position: "MED", rating: 96, rarity: "relic", img: "images/xavihernandez.png" },/*DONE*/
    { id: 11, name: "Carles Puyol", position: "DEF", rating: 92, rarity: "relic", img: "images/carlespuyol.png" },/*DONE*/
    { id: 12, name: "Oliver Khan", position: "POR", rating: 92, rarity: "relic", img: "images/oliverkhan.png" },/*DONE*/

    /* LEGENDARY (16 Jugadores) */
    { id: 13, name: "Kylian Mbappé", position: "DEL", rating: 94, rarity: "legendary", img: "images/kylianmbappe.png" },/*DONE*/
    { id: 14, name: "Erling Haaland", position: "DEL", rating: 93, rarity: "legendary", img: "images/erlinghaaland.png" },/*DONE*/
    { id: 15, name: "Nemanja Vidic", position: "DEF", rating: 93, rarity: "legendary", img: "images/nemanjavidic.png" },/*DONE*/
    { id: 16, name: "Thierry Henry", position: "DEL", rating: 94, rarity: "legendary", img: "images/thierryhenry.png" },/*DONE*/
    { id: 17, name: "Kevin De Bruyne", position: "MED", rating: 92, rarity: "legendary", img: "images/kevindebruyne.png" },/*DONE*/
    { id: 18, name: "Hristo Stoichkov", position: "DEL", rating: 92, rarity: "legendary", img: "images/hristostoichkov.png" },/*DONE*/
    { id: 19, name: "Sergio Busquets", position: "MED", rating: 93, rarity: "legendary", img: "images/sergiobusquets.png" },/*DONE*/
    { id: 20, name: "Zlatan Ibrahimovic", position: "DEL", rating: 91, rarity: "legendary", img: "images/zlatanibrahimovic.png" },/*DONE*/
    { id: 21, name: "Neymar Jr.", position: "DEL", rating: 93, rarity: "legendary", img: "images/neymarjr.png" },/*DONE*/
    { id: 22, name: "Virgil van Dijk", position: "DEF", rating: 91, rarity: "legendary", img: "images/virgilvandijk.png" },/*DONE*/
    { id: 23, name: "Gennaro Gattuso", position: "MED", rating: 91, rarity: "legendary", img: "images/gennarogattuso.png" },/*DONE*/
    { id: 24, name: "Robert Lewandowski", position: "DEL", rating: 91, rarity: "legendary", img: "images/robertlewandowski.png" },/*DONE*/
    { id: 25, name: "Sergio Ramos", position: "DEF", rating: 90, rarity: "legendary", img: "images/sergioramos.png" },/*DONE*/
    { id: 26, name: "Thibaut Courtois", position: "POR", rating: 90, rarity: "legendary", img: "images/thibautcourtois.png" },/*DONE*/
    { id: 27, name: "Mohamed Salah", position: "DEL", rating: 91, rarity: "legendary", img: "images/mohamedsalah.png" },/*DONE*/
    { id: 28, name: "Paolo Maldini", position: "DEF", rating: 94, rarity: "legendary", img: "images/paolomaldini.png" },/*DONE*/
    { id: 54, name: "Lamine Yamal", position: "DEL", rating: 83, rarity: "legendary", img: "images/lamineyamal.png" },/*DONE*/

    /* EPIC (17 Jugadores) */
    { id: 29, name: "Jude Bellingham", position: "MED", rating: 88, rarity: "epic", img: "images/judebellingham.png" },/*DONE*/
    { id: 30, name: "Harry Kane", position: "DEL", rating: 90, rarity: "epic", img: "images/harrykane.png" },/*DONE*/
    { id: 31, name: "Rodri", position: "MED", rating: 89, rarity: "epic", img: "images/rodri.png" },/*DONE*/
    { id: 32, name: "Alisson Becker", position: "POR", rating: 89, rarity: "epic", img: "images/alissonbecker.png" },/*DONE*/
    { id: 33, name: "Pedri", position: "MED", rating: 90, rarity: "epic", img: "images/pedri.png" },/*DONE*/
    { id: 34, name: "Lautaro Martínez", position: "DEL", rating: 88, rarity: "epic", img: "images/lautaromartinez.png" },/*DONE*/
    { id: 35, name: "Bukayo Saka", position: "DEL", rating: 88, rarity: "epic", img: "images/bukayosaka.png" },/*DONE*/
    { id: 36, name: "Jamal Musiala", position: "MED", rating: 88, rarity: "epic", img: "images/jamalmusiala.png" },/*DONE*/
    { id: 37, name: "Julián Álvarez", position: "DEL", rating: 87, rarity: "epic", img: "images/julianalvarez.png" },/*DONE*/
    { id: 38, name: "Frenkie de Jong", position: "MED", rating: 89, rarity: "epic", img: "images/frenkiedejong.png" },/*DONE*/
    { id: 39, name: "William Saliba", position: "DEF", rating: 87, rarity: "epic", img: "images/williamsaliba.png" },/*DONE*/
    { id: 40, name: "Viktor Gyokeres", position: "DEL", rating: 87, rarity: "epic", img: "images/viktorgyokeres.png" },/*DONE*/
    { id: 41, name: "Rúben Dias", position: "DEF", rating: 87, rarity: "epic", img: "images/rubendias.png" },/*DONE*/
    { id: 42, name: "Son Heung-min", position: "DEL", rating: 87, rarity: "epic", img: "images/sonheungmin.png" },/*DONE*/
    { id: 43, name: "Gavi", position: "MED", rating: 86, rarity: "epic", img: "images/gavi.png" },/*DONE*/
    { id: 44, name: "Marc-André ter Stegen", position: "POR", rating: 86, rarity: "epic", img: "images/terstegen.png" },/*DONE*/
    { id: 45, name: "Joan Garcia", position: "POR", rating: 86, rarity: "epic", img: "images/joangarcia.png" },/*DONE*/

    /* RARE (18 Jugadores) */
    { id: 46, name: "Martin Ødegaard", position: "MED", rating: 85, rarity: "rare", img: "images/martinodegaard.png" },/*DONE*/
    { id: 47, name: "Declan Rice", position: "MED", rating: 85, rarity: "rare", img: "images/declanrice.png" },/*DONE*/
    { id: 48, name: "Eric Garcia", position: "DEF", rating: 85, rarity: "rare", img: "images/ericgarcia.png" },/*DONE*/
    { id: 49, name: "Jackson Irvine", position: "MED", rating: 85, rarity: "rare", img: "images/jacksonirvine.png" },/*DONE*/
    { id: 50, name: "Alexis Mac Allister", position: "MED", rating: 84, rarity: "rare", img: "images/alexismacallister.png" },/*DONE*/
    { id: 51, name: "Alejandro Grimaldo", position: "DEF", rating: 84, rarity: "rare", img: "images/alejandrogrimaldo.png" },/*DONE*/
    { id: 52, name: "Theo Hernández", position: "DEF", rating: 84, rarity: "rare", img: "images/theohernandez.png" },/*DONE*/
    { id: 53, name: "Takefusa Kubo", position: "DEL", rating: 83, rarity: "rare", img: "images/takefusakubo.png" },/*DONE*/
    { id: 55, name: "Darwin Núñez", position: "DEL", rating: 81, rarity: "rare", img: "images/darwinnunez.png" },/*DONE*/
    { id: 56, name: "Christopher Nkunku", position: "MED", rating: 82, rarity: "rare", img: "images/christophernkunku.png" },/*DONE*/
    { id: 57, name: "Unai Simón", position: "POR", rating: 81, rarity: "rare", img: "images/unaisimon.png" },/*DONE*/
    { id: 58, name: "Nicolò Barella", position: "MED", rating: 81, rarity: "rare", img: "images/nicolobarella.png" },/*DONE*/
    { id: 59, name: "Alexander Isak", position: "DEL", rating: 84, rarity: "rare", img: "images/alexanderisak.png" },/*DONE*/
    { id: 60, name: "Alphonso Davies", position: "DEF", rating: 81, rarity: "rare", img: "images/alphonsodavies.png" },/*DONE*/
    { id: 61, name: "Ollie Watkins", position: "DEL", rating: 81, rarity: "rare", img: "images/olliewatkins.png" },/*DONE*/
    { id: 62, name: "Mikel Merino", position: "MED", rating: 81, rarity: "rare", img: "images/mikelmerino.png" },/*DONE*/
    { id: 63, name: "Federico Chiesa", position: "DEL", rating: 81, rarity: "rare", img: "images/federicochiesa.png" },/*DONE*/
      
    /* COMMON (25 Jugadores) */
    { id: 64, name: "Enzo Fernández", position: "MED", rating: 82, rarity: "common", img: "images/enzofernandez.png" },/*DONE*/
    { id: 65, name: "Josko Gvardiol", position: "DEF", rating: 82, rarity: "common", img: "images/joskogvardiol.png" },/*DONE*/
    { id: 66, name: "Bruno Guimarães", position: "MED", rating: 82, rarity: "common", img: "images/brunoguimaraes.png" },/*DONE*/
      { id: 67, name: "Dominik Szoboszlai", position: "MED", rating: 82, rarity: "common", img: "images/dominikszoboszlai.png" },
    { id: 68, name: "Lisandro Martínez", position: "DEF", rating: 82, rarity: "common", img: "images/lisandromartinez.png" },/*DONE*/
    { id: 69, name: "Pau Torres", position: "DEF", rating: 81, rarity: "common", img: "images/pautorres.png" },/*DONE*/
    { id: 70, name: "Lucas Paquetá", position: "MED", rating: 81, rarity: "common", img: "images/lucaspaqueta.png" },/*DONE*/
    { id: 71, name: "Nico Williams", position: "DEL", rating: 80, rarity: "common", img: "images/nicowilliams.png" },/*DONE*/
    { id: 72, name: "André Onana", position: "POR", rating: 78, rarity: "common", img: "images/andreonana.png" },/*DONE*/
    { id: 73, name: "Iñaki Williams", position: "DEL", rating: 78, rarity: "common", img: "images/inakiwilliams.png" },/*DONE*/
    { id: 74, name: "João Palhinha", position: "MED", rating: 80, rarity: "common", img: "images/joaopalhinha.png" },/*DONE*/
    { id: 75, name: "Jeremie Frimpong", position: "DEF", rating: 80, rarity: "common", img: "images/jeremiefrimpong.png" },/*DONE*/
    { id: 76, name: "Sandro Tonali", position: "MED", rating: 80, rarity: "common", img: "images/sandrotonali.png" },/*DONE*/
    { id: 77, name: "Ferran Jutgla", position: "DEL", rating: 79, rarity: "common", img: "images/ferranjutgla.png" },/*DONE*/
    { id: 78, name: "Moisés Caicedo", position: "MED", rating: 79, rarity: "common", img: "images/moisescaicedo.png" },/*DONE*/
    { id: 79, name: "Pau Cubarsí", position: "DEF", rating: 81, rarity: "common", img: "images/paucubarsi.png" },/*DONE*/
    { id: 80, name: "Kaoru Mitoma", position: "DEL", rating: 79, rarity: "common", img: "images/kaorumitoma.png" },/*DONE*/
    { id: 81, name: "Guido Rodríguez", position: "MED", rating: 79, rarity: "common", img: "images/guidorodriguez.png" },/*DONE*/
    { id: 82, name: "Álex Baena", position: "MED", rating: 78, rarity: "common", img: "images/alexbaena.png" },/*DONE*/
    { id: 83, name: "Conor Gallagher", position: "MED", rating: 78, rarity: "common", img: "images/conorgallagher.png" },/*DONE*/
    { id: 84, name: "Manuel Ugarte", position: "MED", rating: 78, rarity: "common", img: "images/manuelugarte.png" },/*DONE*/
    { id: 85, name: "Giorgi Mamardashvili", position: "POR", rating: 78, rarity: "common", img: "images/mamardashvili.png" },/*DONE*/
    { id: 86, name: "Santiago Giménez", position: "DEL", rating: 78, rarity: "common", img: "images/santiagogimenez.png" },/*DONE*/
    { id: 87, name: "Alejandro Balde", position: "DEF", rating: 80, rarity: "common", img: "images/alejandrobalde.png" },/*DONE*/
    { id: 88, name: "Anthony Gordon", position: "DEL", rating: 77, rarity: "common", img: "images/anthonygordon.png" }/*DONE*/
    ];

    const CONFIG = {
      packSize: 11,
      rarities: { common: { p: 69.5, p_golden: 1.5, order: 1 }, rare: { p: 21.2, p_golden: 1.1, order: 2 }, epic: { p: 4.2,  p_golden: 0.6, order: 3 }, legendary: { p: 0.8,  p_golden: 0.3, order: 4 }, relic: { p: 0.5,  p_golden: 0.1, order: 5 }, },
      variants: { none: {p:0}, foil: { p: 1.1 }, holo: { p: 0.6 }, poli: { p: 0.3 }, negative: { p: 0.1 }, },
      goldenChance: 3.8,
    };

    function buildProbLists(config) {
      const regularProbs = []; const goldenRaw = [];
      for (const key in config.rarities) { regularProbs.push({ r: key, p: config.rarities[key].p }); goldenRaw.push({ r: key, p: config.rarities[key].p_golden }); }
        const goldenTotalRaw = goldenRaw.reduce((s, x) => s + x.p, 0); const goldenScale = config.goldenChance / goldenTotalRaw;
      const goldenProbs = goldenRaw.map(x => ({ r: x.r, p: x.p * goldenScale }));
      const variantProbs = Object.entries(config.variants).filter(([k,v])=> k !== 'none').map(([key, value]) => ({ v: key, p: value.p }));
      return { regularProbs, goldenProbs, variantProbs };
    }

    const { regularProbs, goldenProbs, variantProbs } = buildProbLists(CONFIG);

    // 1. Intentamos cargar la colección guardada desde localStorage.
    const savedCollection = localStorage.getItem('myFootballCollection');
    
    // 2. Si había algo guardado, lo convertimos de texto a objeto.
    //    Si no había nada (la primera vez que se visita), empezamos con una colección vacía.
    let collection = savedCollection ? JSON.parse(savedCollection) : {};

    let flippedCardsInPack = 0;
    const openPackBtn = document.querySelector('button[onclick="openPack()"]');

    let counters = {};
    for (const rarityKey in CONFIG.rarities) {
      counters[rarityKey] = {};
      for (const variantKey in CONFIG.variants) {
        counters[rarityKey][variantKey] = { normal: 0, golden: 0 };
      }
    }

    function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

    function pickByProb(list) {
      const totalProb = list.reduce((sum, item) => sum + item.p, 0); const roll = Math.random() * totalProb;
      let acc = 0;
      for (const item of list) { acc += item.p; if (roll < acc) return item; }
        return list[list.length - 1];
    }

    function generateCard() {
      const isGolden = ALLOW_GOLDEN_CARDS && (Math.random() * 100) < CONFIG.goldenChance;
      const rarity = isGolden ? pickByProb(goldenProbs).r : pickByProb(regularProbs).r;
      const totalVariantChance = Object.values(CONFIG.variants).reduce((s, v) => s + v.p, 0);
      const variant = (Math.random() * 100 < totalVariantChance) ? pickByProb(variantProbs).v : 'none';
      const playersOfRarity = playersDB.filter(p => p.rarity === rarity);
      const player = playersOfRarity[Math.floor(Math.random() * playersOfRarity.length)];
      return { playerData: player, rarity, golden: isGolden, variant };
    }

    function openPack() {
      openPackBtn.disabled = true; // Desactiva el botón
  flippedCardsInPack = 0;      // Reinicia el contador
  const container = document.getElementById("cards");
  container.innerHTML = "";
  let pack = [];
  for (let i = 0; i < CONFIG.packSize; i++) { 
    pack.push(generateCard());
  }

  if (!pack.some(c => CONFIG.rarities[c.rarity].order > 1)) {
    const rarePlayers = playersDB.filter(p => p.rarity === 'rare');
    pack[0] = { ...generateCard(), rarity: 'rare', playerData: rarePlayers[Math.floor(Math.random() * rarePlayers.length)] };
  }
  pack.sort((a, b) => CONFIG.rarities[a.rarity].order - CONFIG.rarities[b.rarity].order);

  pack.forEach((cardObj, i) => {
    const div = document.createElement("div");
    const variantClass = cardObj.variant !== 'none' ? `variant-${cardObj.variant}` : '';
    div.className = `card ${cardObj.rarity} ${cardObj.golden ? 'golden' : ''} ${variantClass}`;
    div.style.zIndex = pack.length - i;
    div.dataset.rarity = cardObj.rarity;
    div.dataset.golden = cardObj.golden;
    div.dataset.variant = cardObj.variant;
    div.style.transform = `translateX(${i * 2}px) translateY(${i * -2}px)`;

    const indicatorsHTML = `<div class="card-indicators">${cardObj.variant !== 'none' ? `<div class="indicator">${cardObj.variant.charAt(0).toUpperCase()}</div>` : ''}</div>`;

    div.innerHTML = `
          <div class="side front">
            <img src="${cardObj.playerData.img}" class="player-image" alt="${cardObj.playerData.name}" />
            ${indicatorsHTML}
            <div class="player-info">
            </div>
          </div>
          <div class="side back">⚽</div>
    `;
    div.cardData = cardObj;
    div.onclick = () => flipCard(div, i);
    container.appendChild(div);
  });
}

/*esto va en player-info por si acaso el de arriba ye en createShowcase (album)


              <div class="player-rating">${cardObj.playerData.rating}</div>
              <div class="player-position">${cardObj.playerData.position}</div>

*/

function flipCard(card, index) {
  if (card.classList.contains("flipped")) return;

      flippedCardsInPack++; // Incrementa el contador
      if (flippedCardsInPack === CONFIG.packSize) {
    openPackBtn.disabled = false; // Reactiva el botón si es la última carta
  }

  const flipSound = document.getElementById('flipSound');
  if (flipSound) {
    flipSound.currentTime = 0;
    flipSound.play();
  }

  const cardObj = card.cardData;
  const playerId = cardObj.playerData.id;
  const variantKey = `${cardObj.golden}_${cardObj.variant}`;

  if (!collection[playerId]) {
    collection[playerId] = {};
  }
  if (!collection[playerId][variantKey]) {
    collection[playerId][variantKey] = { count: 1, cardData: cardObj };
  } else {
    collection[playerId][variantKey].count++;
  }

  localStorage.setItem('myFootballCollection', JSON.stringify(collection));

  const rarity = card.dataset.rarity;
  const isGolden = card.dataset.golden === "true";
  const variant = card.dataset.variant;

  card.classList.add("flipped", "is-animating"); 

  setTimeout(() => {
    card.classList.remove("is-animating");
    addInteractiveTilt(card);
  }, 700);

  if (isGolden) {
    counters[rarity][variant].golden++;
  } else {
    counters[rarity][variant].normal++;
  }

  const cardSpacing = 140; 
  const spread = (CONFIG.packSize - 1) * cardSpacing / 2;
  card.style.left = `${-spread + index * cardSpacing}px`;
  card.style.top = `calc(var(--card-h) + 30px)`;
  card.style.transform = 'rotateY(180deg)';


  addReactiveEffects(card);

}

function updateCounter() {
  for (const rarityKey in counters) {
    for (const variantKey in counters[rarityKey]) {
      const capRarity = capitalize(rarityKey);
      const capVariant = capitalize(variantKey);

      const normalId = `c${capRarity}${capVariant}`;
      const goldenId = `cg${capRarity}${capVariant}`;

      if(document.getElementById(normalId)) {
        document.getElementById(normalId).textContent = counters[rarityKey][variantKey].normal;
      }
      if(document.getElementById(goldenId)) {
        document.getElementById(goldenId).textContent = counters[rarityKey][variantKey].golden;
      }
    }
  }
}

function createShowcase() {
  const container = document.getElementById('showcase-content');
  container.innerHTML = '';

  const raritiesInOrder = Object.keys(CONFIG.rarities).sort((a, b) => CONFIG.rarities[a].order - CONFIG.rarities[b].order);
  const variantKeys = Object.keys(CONFIG.variants);

  // Iteramos por cada rareza para crear una fila en el álbum
  raritiesInOrder.forEach(rarityKey => {
    const playersInRarity = playersDB.filter(p => p.rarity === rarityKey);
    if (playersInRarity.length === 0) return;

    const row = document.createElement('div');
    row.className = 'showcase-row';
    row.innerHTML = `<h2>${rarityKey}</h2><div class="showcase-grid"></div>`;
    const grid = row.querySelector('.showcase-grid');

    // Para cada jugador en la DB, creamos una entrada completa en el álbum
    playersInRarity.forEach(player => {
      const playerEntry = document.createElement('div');
      playerEntry.className = 'player-album-entry';

      const variantsGrid = document.createElement('div');
      variantsGrid.className = 'variants-grid';

      //hueco para CADA VARIANTE POSIBLE
      for (const isGolden of [false, true]) {
        for (const variantKey of variantKeys) {
          const lookupKey = `${isGolden}_${variantKey}`;
          const collectedVersion = collection[player.id]?.[lookupKey];

          if (TEST_MODE_FILL_ALBUM || collectedVersion) {
            // VARIANTE OBTENIDA
            const cardData = collectedVersion 
            ? collectedVersion.cardData 
            : { playerData: player, rarity: player.rarity, golden: isGolden, variant: variantKey };

            const count = collectedVersion ? collectedVersion.count : 1;
            const div = document.createElement("div");
            const variantClass = cardData.variant !== 'none' ? `variant-${cardData.variant}` : '';
            div.className = `card showcase-card flipped ${cardData.rarity} ${cardData.golden ? 'golden' : ''} ${variantClass}`;

            const indicatorsHTML = `<div class="card-indicators">${cardData.variant !== 'none' ? `<div class="indicator">${cardData.variant.charAt(0).toUpperCase()}</div>` : ''}</div>`;

            // --- ¡AQUÍ ESTÁ LA CORRECCIÓN! ---
            // Usamos la variable 'count' que es segura, en lugar de 'collectedVersion.count'
            const duplicateCounterHTML = count > 1 ? `<div class="duplicate-counter">x${count}</div>` : '';

            div.innerHTML = `
              <div class="side front">
                <img src="${cardData.playerData.img}" class="player-image" alt="${cardData.playerData.name}" />
                ${indicatorsHTML}
                ${duplicateCounterHTML}
                <div class="player-info">
                </div>
            </div>`;
            variantsGrid.appendChild(div);
            addInteractiveTilt(div);
            addReactiveEffects(div);
          } else {
            //HUECO VACÍO (sin cambios aquí)
            const placeholder = document.createElement('div');
            placeholder.className = 'card showcase-card album-placeholder';

            const phIndicators = `
              <div class="placeholder-indicators">
                ${isGolden ? '<div class="placeholder-indicator golden-indicator">Golden</div>' : ''}
              ${variantKey !== 'none' ? `<div class="placeholder-indicator">${capitalize(variantKey)}</div>` : ''}
              </div>
            `;
            placeholder.innerHTML = phIndicators;
            variantsGrid.appendChild(placeholder);
          }
        }
      }
      playerEntry.innerHTML = `<h3>${player.name}</h3>`;
      playerEntry.appendChild(variantsGrid);
      grid.appendChild(playerEntry);
    });
    container.appendChild(row);
  });
}

const showcaseOverlay = document.getElementById('showcase-overlay');
const showcaseBtn = document.getElementById('showcaseBtn');
const closeShowcaseBtn = document.getElementById('closeShowcaseBtn');

showcaseBtn.addEventListener('click', () => {
  createShowcase();
  showcaseOverlay.classList.add('visible');
});
closeShowcaseBtn.addEventListener('click', () => {
  showcaseOverlay.classList.remove('visible');
});
showcaseOverlay.addEventListener('click', (e) => {
  if (e.target === showcaseOverlay) {
    showcaseOverlay.classList.remove('visible');
  }
});

function addInteractiveTilt(cardElement) {
  cardElement.addEventListener("mousemove", (e) => {
    if (cardElement.classList.contains('is-animating')) {
      return;
    }

    const rect = cardElement.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const rotateX = ((y / rect.height) - 0.5) * 40; 
    const rotateY = ((x / rect.width) - 0.5) * 40; 

    cardElement.classList.add('tilting');
    cardElement.style.transform = `rotateY(180deg) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.25)`;
    cardElement.style.zIndex = '999'; 
  });

  cardElement.addEventListener("mouseleave", () => {
    cardElement.classList.remove('tilting');
    cardElement.style.transform = "rotateY(180deg)";
    cardElement.style.zIndex = '';
  });
}

function addReactiveEffects(cardElement) {
  if (!cardElement.classList.contains('flipped')) return;

  cardElement.addEventListener('mousemove', (e) => {
    const bounds = cardElement.getBoundingClientRect();
    const mouseX = e.clientX - bounds.left;
    const mouseY = e.clientY - bounds.top;
    const centerX = bounds.width / 2;
    const centerY = bounds.height / 2;
    
    const posX = (mouseY - centerY) * -0.12;
    const posY = (mouseX - centerX) * 0.12;

    cardElement.style.setProperty('--x', posX);
    cardElement.style.setProperty('--y', posY);
  });

  cardElement.addEventListener('mouseleave', () => {
    cardElement.style.setProperty('--x', 0);
    cardElement.style.setProperty('--y', 0);
  });
}

function resetCollection() {
  // Preguntamos para evitar clics accidentales
  if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
    // Borramos los datos del localStorage
    localStorage.removeItem('myFootballCollection');
    // Recargamos la página para que se apliquen los cambios
    location.reload();
  }
}

// Sonido botones
const buttonSound = document.getElementById('buttonClickSound');
const allButtons = document.querySelectorAll('button');

allButtons.forEach(button => {
  button.addEventListener('click', () => {
    if (buttonSound) {
      buttonSound.currentTime = 0;
      buttonSound.play();
    }
  });
});

openPack();

</script>
</body>
</html>
