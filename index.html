<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Football TCG</title>
  <link rel="icon" type="image/png" href="images/Logo.png">
  <style>
    :root{
      --card-w: 130px;
      --card-h: 185px;
    }

    @property --x { syntax: '<number>'; initial-value: 0; inherits: true; }
    @property --y { syntax: '<number>'; initial-value: 0; inherits: true; }

    @property --rotate-border {
      syntax: "<angle>";
      initial-value: 0deg;
      inherits: false;
    }

    @property --rotate {
      syntax: "<angle>";
      initial-value: 132deg;
      inherits: false;
    }

    @keyframes spin {
      0% {
        --rotate: 0deg;
      }
      100% {
        --rotate: 360deg;
      }
    }


    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      color: white;
      padding: 20px;

      /* --- Propiedades para la imagen de fondo --- */
      background-color: #111217; /* Color de respaldo si la imagen no carga */
      background-image: url('images/fondo.jpg'); /* Ruta a tu imagen */
      background-size: cover; /* Asegura que la imagen cubra todo el espacio sin deformarse */
      background-position: center center; /* Centra la imagen horizontal y verticalmente */
      background-repeat: no-repeat; /* Evita que la imagen se repita si es pequeña */
      background-attachment: fixed; /* Fija la imagen para que no se mueva al hacer scroll */
    }


    h1 {
      color: #eee;
      text-shadow: 0 0 10px rgba(31, 255, 7, 0.3);
    }
    #cards {
      position: relative;
      width: calc(var(--card-w) + 20px);
      height: var(--card-h);
      margin: 50px auto calc(var(--card-h) + 60px) auto;
      perspective: 1200px;
    }
    .card {
      width: var(--card-w);
      height: var(--card-h);
      perspective: 1000px;
      border-radius: 12px;
      position: absolute;
      top: 0;
      left: 0;
      transform-style: preserve-3d;
      /* La transición de transform debe ser RÁPIDA para el hover. El volteo lo controlaremos de otra forma. */
      transition: transform 0.2s ease-out, left 0.7s ease, top 0.7s ease, box-shadow 0.5s ease;
      cursor: pointer;
      user-select: none;
    }
    .card .side {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      overflow: hidden;
      padding: 10px;
      box-sizing: border-box;
    }
    .card .back {
      background-image: url('images/card-back.png');
      background-size: cover;
      background-position: center;
      background-color: #035700;
      transform: rotateY(0deg);
      font-size: 0; 
    }
    .card .front {
      transform:
      rotateY(180deg)
      rotateX(calc(var(--x) * 1deg))
      rotateY(calc(var(--y) * 1deg));
      transition: transform 0.2s ease;
      will-change: transform;
    }

    .card.flipped{ 
      transform: rotateY(180deg); 
    }

    .card.common { --rarity-color: #8a8a8a; }
    .card.rare { --rarity-color: #4a7dff; }
    .card.epic { --rarity-color: #a053de; }
    .card.legendary { --rarity-color: #ffc84a; }
    .card.relic { --rarity-color: #4af0e0; }

    /* 1. Sombra para la carta VOLTEADA (en la cara frontal) */
    .card.flipped .front {
      box-shadow: 0 0 7px 3px var(--rarity-color);
    }

/* 2. Sombra para la carta SIN VOLTEAR (en el contenedor) */
.card:not(.flipped) {
  box-shadow: 0 0 20px 5px var(--rarity-color);
}

.common .front { background: linear-gradient(170deg, #8a8a8a, #505050); }
.rare .front { background: linear-gradient(170deg, #4a7dff, #294eb0); }
.epic .front { background: linear-gradient(170deg, #a053de, #6a2b9e); }
.legendary .front { background: linear-gradient(170deg, #ffc84a, #d1921a); }
.relic .front { background: linear-gradient(170deg, #4af0e0, #1e9e8f); }


/* --- EFECTO DORADO REFINADO (BASE PRESENTE + BRILLO SUTIL) --- */

/* Usamos ::after en .front, que es la solución estable que ya no se corta. */
.card.golden .front::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 12px;
  z-index: 4;
  pointer-events: none;

  /* --- ESTRATEGIA DE MÚLTIPLES FONDOS --- */
  /* El primer fondo de la lista es la capa SUPERIOR, el último es la capa INFERIOR. */
  
  background-image:
  /* CAPA 2 (SUPERIOR): El brillo animado, ahora mucho más sutil. */
  linear-gradient(
    120deg,
    transparent 25%,
    rgba(255, 235, 150, 0.5) 50%, /* Amarillo muy claro y semitransparente */
    transparent 65%
  ),
  /* CAPA 1 (INFERIOR): La base de oro estática, ahora más presente. */
  radial-gradient(
    ellipse at 50% 50%,
    rgba(255, 215, 0, 0.55),   /* Centro dorado más intenso */
    rgba(200, 140, 40, 0.75)   /* Bordes con un tono bronce más oscuro y opaco */
  );

  /* Tamaños para cada fondo: El primero para el brillo, el segundo para la base. */
  background-size: 300% 100%, 100% 100%;
  
  /* Posición inicial para cada fondo. Solo moveremos la del brillo. */
  background-position: 0% 50%, 0 0;
  
  /* 'overlay' mezcla las capas de forma muy rica y metálica. */
  mix-blend-mode: overlay;
  
  /* La animación solo afectará a la capa de brillo. */
  animation: subtle-gold-shine 6.5s ease-in-out infinite alternate;
}

/* Animación corregida para un barrido completo y visible. */
@keyframes subtle-gold-shine { 
  from {
    /* Empezamos con el brillo completamente fuera, a la derecha */
    background-position: 150% 50%, 0 0;
  }
  to {
    /* Terminamos con el brillo completamente fuera, a la izquierda */
    background-position: -150% 50%, 0 0;
  }
}


@keyframes foil-sweep {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes smooth-gold-shine {
  0% {
    opacity: 0.6;
    background-position: 0% 0%;
    filter: brightness(0.6) contrast(1.2);
  }
  50% {
    opacity: 0.75;
    background-position: 100% 100%;
    filter: brightness(0.75) contrast(1.5);
  }
  100% {
    opacity: 0.6;
    background-position: 0% 0%;
    filter: brightness(0.6) contrast(1.2);
  }
}

@keyframes holo-shine {
  0% { background-position: 100% 0%; }
  50% { background-position: 0% 100%; }
  100% { background-position: 100% 0%; }
}

@keyframes hue-cycle {
  from { filter: hue-rotate(0deg); }
  to { filter: hue-rotate(360deg); }
}

@keyframes hue-cycle-background {
  to { background-position: -200% center; }
}

@keyframes breathe-negative {
  0%, 100% {
    filter: sepia(100%) brightness(125%) contrast(150%) saturate(105%) invert(100%);
  }
  50% {
    filter: sepia(100%) brightness(150%) contrast(180%) saturate(105%) invert(100%);
  }
}

/* --- EFECTO FOIL REACTIVO (CORREGIDO) --- */
.variant-foil .front::before {
  content: ''; position: absolute; inset: 0; z-index: 5; pointer-events: none;
  background-image: radial-gradient(ellipse at center,
    rgba(220, 230, 255, 0.33) 0%,
    rgba(220, 230, 255, 0.15) 20%,
    transparent 60%);
  background-size: 200% 200%;
  background-position: calc(50% + var(--y) * 8%) calc(50% + var(--x) * 8%);
  mix-blend-mode: color-dodge;
  opacity: 0; /* Por defecto invisible */
  transition: opacity 0.4s ease-out;
  will-change: background-position, opacity;
}
.card.variant-foil.tilting .front::before {
  opacity: 1; /* Hacemos visible el efecto al interactuar */
}

/* --- EFECTO HOLO REACTIVO (CON TRANSICIÓN ASIMÉTRICA) --- */
.variant-holo .front::before {
  content: '';
  position: absolute; inset: 0; z-index: 5; pointer-events: none;
  background-image: url('images/holoeffect.png');
  background-size: cover;
  mask-image: radial-gradient(ellipse at center, white 25%, transparent 60%);
  mask-size: 200% 200%;
  mask-position: calc(50% + var(--y) * 8%) calc(50% + var(--x) * 8%);
  mix-blend-mode: overlay;
  opacity: 0;

  transition: opacity 0.8s ease-out;
  
  will-change: mask-position, opacity;
}

.card.variant-holo.tilting .front::before {
  opacity: 1;
  
  transition: opacity 0.3s ease-in; 
}

.card.variant-holo.tilting .front::before {
  opacity: 1; 
}

/* --- EFECTO POLI REACTIVO --- */
.variant-poli .front {
  filter: hue-rotate(calc(var(--y) * 10deg))
  saturate(calc(1.5 + var(--x) * 0.1))
  brightness(1.1);
}

/* --- EFECTO NEGATIVO REACTIVO (CORREGIDO Y SUTIL) --- */

/* 1. Define el estado BASE (estático) de la carta negativa */
.variant-negative .front {
  filter: invert(1) saturate(2) brightness(1);
  transition: filter 0.4s ease-out;
  will-change: filter;
}

/* 2. Define el estado ACTIVO (cuando el ratón está encima) */
.card.variant-negative.tilting .front {
  filter: invert(1)
  saturate(calc(2 + abs(var(--y)) * 0.5))
  /* AQUÍ ESTÁ EL CAMBIO: El brillo ahora es mucho más sutil */
  brightness(calc(1 + var(--x) * 0.02)) 
  hue-rotate(calc(var(--y) * 5deg));
}

.player-image {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; 
  border-radius: 10px; z-index: 1; opacity: 0.85;
}
.front::after {
  content: ''; position: absolute; inset: 0; border-radius: 10px;
  background: linear-gradient(to top, rgba(0,0,0,0.15) 0%, transparent 40%, transparent 60%, rgba(0,0,0,0.15) 100%);
  z-index: 2;
}

.card .front .player-info { z-index: 3; text-shadow: 0 1px 3px rgba(0,0,0,0.9); display: flex; flex-direction: column; position: relative; width: 100%; height: 100%; }

.player-rating {
  font-size: 18px; font-weight: 700; position: absolute;
  top: 4px; right: 8px; text-align: right;
}
.player-position {
  font-size: 10px; background: rgba(0,0,0,0.4); padding: 2px 5px; border-radius: 4px; position: absolute;
  top: 24px; right: 8px; text-align: right;
}

.card-indicators { position: absolute; top: 8px; left: 8px; z-index: 4; display: flex; gap: 4px; font-size: 12px; text-shadow: 0 1px 1px #000; }
.indicator { background: rgba(0,0,0,0.5); padding: 1px 5px; border-radius: 4px; }

#counter {
  margin-top: 40px;
  display: flex;
  flex-direction: column;
  gap: 15px; /* Espacio entre filas de rareza */
  max-width: 1300px;
  margin-left: auto;
  margin-right: auto;
}
.counter-row {
  display: grid;
  grid-template-columns: repeat(10, 1fr); /* 10 cajas por fila */
  gap: 8px;
}
.count-box{ background:#1d1f24; border-radius:8px; padding:8px; font-size:14px; text-align:center; box-shadow:0 0 8px rgba(0,0,0,0.5); }
.count-box span { font-weight: bold; }

button{ margin-top:20px; padding:12px 24px; border-radius:8px; border:none; background:#1f7; color:#022; font-weight:700; cursor:pointer; font-size: 16px; transition: transform 0.2s, box-shadow 0.2s; }

/* 1. Efecto de escala universal para TODOS los botones al pasar el ratón */
button:not(:disabled):hover {
  transform: scale(1.05);
}

/* 2. Glow VERDE específico para "Open Pack" */
button[onclick="openPack()"]:hover {
  box-shadow: 0 0 15px rgba(31, 255, 7, 0.4);
}

/* 3. Glow AZUL específico para "My Album" (este ya lo tenías, pero lo dejamos aquí para consistencia) */
#showcaseBtn:hover { 
  box-shadow: 0 0 15px rgba(59, 104, 209, 0.6); 
}

/* 4. Glow NARANJA/AMARILLO específico para "Reset Progress" */
button[onclick="resetCollection()"]:hover {
  box-shadow: 0 0 15px rgba(230, 161, 21, 0.6);
}

.button-container { 
  display: flex; 
  justify-content: center; 
  gap: 10px; 
  margin-top:20px; 
}
#showcaseBtn { 
  background-color: #3b68d1; 
  color: #fff; 
}
#showcaseBtn:hover { 
  box-shadow: 0 0 15px rgba(59, 104, 209, 0.6); 
}

#showcase-overlay {
  position: fixed; 
  inset: 0; 
  background: rgba(10, 12, 20, 0.95); 
  z-index: 100;
  display: none; 
  align-items: center; 
  justify-content: flex-start; 
  flex-direction: column;
  padding: 40px 20px; 
  overflow-y: auto;
}
#showcase-overlay.visible { 
  display: flex; 
}
#showcase-content {
  width: 100%; 
  max-width: 1600px; 
  display: flex; 
  flex-direction: column; 
  gap: 20px;
}
.showcase-row {
  background: rgba(255,255,255,0.03); 
  border-radius: 12px; 
  padding: 15px;
}
.showcase-row h2 {
  margin: 0 0 15px 0; 
  text-align: left; 
  text-transform: capitalize;
}
.showcase-grid {
  display: flex; 
  flex-wrap: wrap; 
  gap: 10px;
}
.showcase-card {
  width: var(--card-w); 
  height: var(--card-h);
  position: relative; 
  top: auto; 
  left: auto;
  cursor: default;
}
#closeShowcaseBtn {
  position: fixed; 
  top: 20px; 
  right: 20px;
  width: 40px; 
  height: 40px; 
  padding: 0; 
  font-size: 20px;
  background-color: #ff4d4d; 
  color: #fff;
}
#closeShowcaseBtn:hover { 
  box-shadow: 0 0 15px rgba(255, 77, 77, 0.6); 
}

.placeholder-name {
  position: absolute;
  bottom: 10px;
  left: 0;
  right: 0;
  font-weight: bold;
}

.showcase-grid {
  display: flex;
  flex-direction: column; /* Apilamos las entradas de jugadores verticalmente */
  gap: 20px;
}

.player-album-entry {
  background: rgba(0,0,0,0.15);
  border-radius: 8px;
  padding: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}
.player-album-entry h3 {
  text-align: left;
  margin: 0 0 10px 5px;
  font-size: 16px;
  color: #ccc;
}

.variants-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.album-placeholder {
  background: rgba(0,0,0,0.2);
  border: 2px dashed #444;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #777;
  box-sizing: border-box;
  position: relative;
}


.placeholder-indicator {
  font-weight: bold;
  font-size: 14px;
  width: 75px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.placeholder-indicator.golden-indicator {
  color: #ffc84a;
  border-color: #ffc84a;
}

.duplicate-counter {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  padding: 2px 6px;
  border-radius: 5px;
  z-index: 4;
  border: 1px solid #fff;
  text-shadow: 0 0 3px #000;
}

button:disabled {
  background-color: #555;
  color: #999;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

h1 img {
  height: 300px; 
  width: auto;
  filter: drop-shadow(0 0 10px rgba(0, 160, 250, 0.5));
}

/*MEDIA QUERIES*/
@media (max-width: 768px) {
  :root {
    /* Hacemos las cartas más pequeñas en móviles */
    --card-w: 100px;
    --card-h: 142px;
  }

  body {
    padding: 10px; /* Menos espacio en los bordes */
  }

  h1 img {
    height: 150px; /* Hacemos el logo más pequeño */
  }

  .button-container {
    /* Hacemos que los botones se apilen verticalmente si no caben */
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }
  
  button {
    width: 80%; /* Hacemos los botones más grandes para que sean fáciles de tocar */
    max-width: 300px;
    padding: 15px;
  }
  
  /* Ajustamos el overlay del álbum para móviles */
  #showcase-overlay {
    padding: 20px 10px;
  }
  
  /* Hacemos el zoom de inspección un poco más pequeño en móviles */
  .zoomed-card {
    scale: 3;
  }
}

@media (max-width: 480px) {
  /* Ajustes extra para pantallas muy pequeñas */
  :root {
    --card-w: 80px;
    --card-h: 114px;
  }

  .zoomed-card {
    scale: 2.5;
  }
}

/* --- INDICADOR DE CARTA NUEVA (CORREGIDO) --- */
.new-indicator {
  position: absolute;
  top: -8px;       /* Lo movemos un poco hacia arriba */
  right: -15px;     /* Lo movemos un poco a la izquierda */
  z-index: 9999;   /* Un z-index alto para que esté por encima de todo */
  font-size: 24px;
  font-weight: 900;
  color: #ffeb3b;
  transform: rotate(-30deg) rotateY(180deg);
  pointer-events: none;
  text-shadow: 
  -1.5px -1.5px 0 #000,  
  1.5px -1.5px 0 #000,
  -1.5px  1.5px 0 #000,
  1.5px  1.5px 0 #000,
  0 0 5px rgba(0,0,0,0.5);
  
  /* Animación actualizada: 3.5s de duración y 0.6s de retraso */
  animation: new-fade-in-out 3.5s ease-in-out 0.6s forwards;
  opacity: 0; /* Empezará invisible hasta que la animación comience */
}

/* Keyframes actualizados para que el texto permanezca visible más tiempo */
@keyframes new-fade-in-out {
  0% {
    opacity: 0;
    transform: rotate(45deg) rotateY(180deg) scale(0.5);
  }
  15% {
    opacity: 1;
    transform: rotate(30deg) rotateY(180deg) scale(1.1);
  }
  85% {
    opacity: 1;
    transform: rotate(30deg) rotateY(180deg) scale(1);
  }
  100% {
    opacity: 0;
    transform: rotate(35deg) rotateY(180deg) scale(0.8);
  }
}

/* --- BORDE DORADO METÁLICO Y ANIMADO --- */

/* 1. Mantenemos el glow de rareza en el :front como siempre. */
.card.golden.flipped .front {
  box-shadow: 0 0 7px 3px var(--rarity-color);
}

/* 2. Usamos la misma capa segura de antes (.player-info::before) para el borde. */
.card.golden .front .player-info::before {
  content: '';
  position: absolute;
  inset: -10px;
  border-radius: 12px;
  pointer-events: none;

  /* --- LA MAGIA DEL BORDE METÁLICO Y ANIMADO --- */

  /* a) Creamos un borde transparente de 3px. Este será nuestro "lienzo". */
  border: 3px solid transparent;

  /* b) Pintamos ese lienzo transparente con nuestro gradiente animado. */
  border-image: conic-gradient(
    from var(--rotate-border),
    #a2682a,       /* Bronce oscuro */
    #e1b453,       /* Oro brillante */
    #ffffc2 5%,    /* Punto de luz máximo */
    #e1b453,       /* Oro brillante */
    #a2682a 20%    /* El resto es bronce oscuro */
  ) 1; /* El '1' es necesario para que el gradiente se aplique correctamente */
  
  /* c) Le decimos al fondo que se recorte para no aparecer debajo del borde. */
  background-clip: padding-box;

  /* d) Aplicamos la animación que hará girar el brillo. */
  animation: spin-the-border 4s linear infinite;
}

/* La animación que cambia el ángulo de la variable, haciendo girar el brillo. */
@keyframes spin-the-border {
  to {
    --rotate-border: 360deg;
  }
}

/* --- CSS PARA INSPECCIÓN DE CARTA --- */
#inspect-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 12, 20, 0.9); /* Fondo oscuro semitransparente */
  z-index: 1000; /* Por encima de todo lo demás */
  display: grid; /* Usamos grid para centrar fácilmente */
  place-items: center; /* Centra el contenido vertical y horizontalmente */
  
  /* Transición para un fade-in/fade-out suave */
  opacity: 0;
  pointer-events: none; /* No se puede hacer clic cuando está oculto */
  transition: opacity 0.3s ease-out;
}

#inspect-overlay.visible {
  opacity: 1;
  pointer-events: auto; /* Se puede hacer clic cuando está visible */
}

/* LA MAGIA ANTI-PIXELACIÓN: */
/* Redefinimos el tamaño de la carta SÓLO cuando está dentro del overlay */
#inspect-overlay .card {
  /* Usamos un tamaño 3 veces mayor que el original */
  --card-w: 390px;  /* 130px * 3 */
  --card-h: 555px;  /* 185px * 3 */
  
  /* La hacemos estática, sin posición absoluta, para que el grid la centre */
  position: relative; 
  top: auto;
  left: auto;
  
  /* Le damos un cursor para indicar que se puede cerrar */
  cursor: zoom-out;
}

/* --- ESTILOS PARA EL NUEVO SISTEMA DE FILTROS (CORREGIDO) --- */
#showcase-filters-container {
  width: 100%;
  max-width: 1600px;
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

#filter-controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
}

.filter-btn {
  position: relative;
  overflow: hidden;
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #555;
  background-color: rgba(0,0,0,0.3);
  color: #ccc;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
}

.filter-btn > * {
  position: relative;
  z-index: 2;
}

/* --- LÓGICA DE HOVER Y ACTIVE CORREGIDA --- */
/* 1. ESTADO ACTIVO: Reglas directas y específicas para cada botón cuando está seleccionado */
.filter-btn.active { color: #fff; } /* Texto blanco para todos los activos */

.filter-btn[data-filter-value="common"].active { background-color: #8a8a8a; border-color: #8a8a8a; box-shadow: 0 0 10px 2px #8a8a8a; }
.filter-btn[data-filter-value="rare"].active { background-color: #4a7dff; border-color: #4a7dff; box-shadow: 0 0 10px 2px #4a7dff; }
.filter-btn[data-filter-value="epic"].active { background-color: #a053de; border-color: #a053de; box-shadow: 0 0 10px 2px #a053de; }
.filter-btn[data-filter-value="legendary"].active { background-color: #ffc84a; border-color: #ffc84a; box-shadow: 0 0 10px 2px #ffc84a; }
.filter-btn[data-filter-value="relic"].active { background-color: #4af0e0; border-color: #4af0e0; box-shadow: 0 0 10px 2px #4af0e0; }
.filter-btn[data-filter-value="golden"].active { background-color: #ffd700; border-color: #ffd700; box-shadow: 0 0 10px 2px #ffd700; }

/* 2. ESTADO HOVER: Se aplica SÓLO si el botón NO está activo */
.filter-btn:not(.active):not(:disabled):hover { color: #fff; } /* Texto blanco en hover */

.filter-btn[data-filter-value="common"]:not(.active):not(:disabled):hover { background-color: #8a8a8a; border-color: #8a8a8a; box-shadow: 0 0 15px rgba(138, 138, 138, 0.6); }
.filter-btn[data-filter-value="rare"]:not(.active):not(:disabled):hover { background-color: #4a7dff; border-color: #4a7dff; box-shadow: 0 0 15px rgba(74, 125, 255, 0.6); }
.filter-btn[data-filter-value="epic"]:not(.active):not(:disabled):hover { background-color: #a053de; border-color: #a053de; box-shadow: 0 0 15px rgba(160, 83, 222, 0.6); }
.filter-btn[data-filter-value="legendary"]:not(.active):not(:disabled):hover { background-color: #ffc84a; border-color: #ffc84a; box-shadow: 0 0 15px rgba(255, 200, 74, 0.6); }
.filter-btn[data-filter-value="relic"]:not(.active):not(:disabled):hover { background-color: #4af0e0; border-color: #4af0e0; box-shadow: 0 0 15px rgba(74, 240, 224, 0.6); }
.filter-btn[data-filter-value="golden"]:not(.active):not(:disabled):hover { background-color: #ffd700; border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
.filter-btn.variant-filter:not(.active):not(:disabled):hover { background-color: #555; border-color: #777; box-shadow: 0 0 15px rgba(200, 200, 200, 0.4); }

/* --- EFECTOS DE VARIANTE PARA BOTONES DE FILTRO (VERSIÓN MEJORADA) --- */

/* Base para los pseudo-elementos de los efectos */
.filter-btn.variant-filter::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 1;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  pointer-events: none; /* Importante para no bloquear el clic */
}

/* Efecto FOIL (::before) */
.filter-btn[data-filter-value="foil"]::before {
  background-image: radial-gradient(ellipse at center, rgba(200, 215, 255, 0.8) 0%, transparent 80%);
  mix-blend-mode: color-dodge;
}

/* Fondo para FOIL (se activa junto con el ::before) */
.filter-btn[data-filter-value="foil"]:not(:active):not(:disabled):hover,
.filter-btn[data-filter-value="foil"].active {
  background-color: #6a7a9c; /* Fondo gris-azulado para que el foil destaque */
  border-color: #aab8d8;
  box-shadow: 0 0 15px rgba(170, 184, 216, 0.6);
}


/* Efecto HOLO (::before) */
.filter-btn[data-filter-value="holo"]::before {
  background-image: url('images/holoeffect.png');
  background-size: 150% 150%;
  mix-blend-mode: overlay;
  animation: holo-shine 5s ease-in-out infinite alternate;
}

/* Fondo para HOLO */
.filter-btn[data-filter-value="holo"]:not(:active):not(:disabled):hover,
.filter-btn[data-filter-value="holo"].active {
  background-color: #3b3a5c; /* Fondo oscuro y purpúreo para que el holo destaque */
  border-color: #7b79a8;
  box-shadow: 0 0 15px rgba(123, 121, 168, 0.6);
}


/* --- LÓGICA UNIFICADA PARA MOSTRAR EFECTOS (::before) --- */

/* Esta regla activa la opacidad para Foil y Holo tanto en hover como en active */
.filter-btn[data-filter-value="foil"]:not(:active):not(:disabled):hover::before,
.filter-btn[data-filter-value="foil"].active::before,
.filter-btn[data-filter-value="holo"]:not(:active):not(:disabled):hover::before,
.filter-btn[data-filter-value="holo"].active::before {
  opacity: 1;
}

/* --- EFECTOS DIRECTOS EN EL BOTÓN (POLI Y NEGATIVE) --- */

/* Estilo para POLI */
.filter-btn[data-filter-value="poli"]:not(:active):not(:disabled):hover,
.filter-btn[data-filter-value="poli"].active {
  background-image: linear-gradient(90deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
  background-size: 200% 100%;
  border-color: #fff;
  animation: hue-cycle-background 8s linear infinite;
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
}

/* Estilo para NEGATIVE (Fondo blanco brillante) */
.filter-btn[data-filter-value="negative"]:not(:active):not(:disabled):hover,
.filter-btn[data-filter-value="negative"].active {
  background-color: #ffffff; /* Fondo blanco puro */
  border-color: #d0d0d0;
  color: #000; /* Texto negro para contraste máximo */
  box-shadow: 0 0 18px 4px rgba(255, 255, 255, 0.8); /* Glow blanco intenso */
}

/* --- GOLDEN BUTTON: textura foil + transición suave + glow dorado --- */
.filter-btn[data-filter-value="golden"] {
  position: relative; /* ya lo tienes, por si acaso */
  overflow: hidden;
  transition: box-shadow 0.28s ease, color 0.18s ease, background-color 0.28s ease;
}

/* pseudo-elemento con la textura (transicionable con opacity/transform) */
.filter-btn[data-filter-value="golden"]::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 1;                    /* por debajo del texto (-> .filter-btn > * tiene z-index:2) */
  background-image: url('images/foil-gold-texture.png');
  background-size: cover;
  background-position: center;
  mix-blend-mode: overlay;       /* mezcla para efecto metálico */
  opacity: 0;
  transform: scale(1.02);
  transition: opacity 0.45s ease, transform 0.45s ease;
  pointer-events: none;
  border-radius: 6px;            /* que coincida con el botón */
}

/* cuando hover (y no activo) o cuando está activo, mostramos la textura y el glow */
.filter-btn[data-filter-value="golden"]:not(.active):not(:disabled):hover::before,
.filter-btn[data-filter-value="golden"].active::before {
  opacity: 1;
  transform: scale(1);
}

/* fondo base + glow dorado (hover y active) */
.filter-btn[data-filter-value="golden"]:not(.active):not(:disabled):hover,
.filter-btn[data-filter-value="golden"].active {
  background-color: #ffd700;
  border-color: #ffd700;
  color: #fff;
  /* Glow similar al resto pero dorado */
  box-shadow: 0 0 18px 4px rgba(255,215,0,0.55);
  /* Si quieres un glow más acusado: box-shadow: 0 0 25px 6px rgba(255,215,0,0.65); */
}

/* por si el botón tiene texto/íconos, garantizamos que estén por encima */
.filter-btn[data-filter-value="golden"] > * { position: relative; z-index: 2; }


/* Estado DESHABILITADO del botón */
.filter-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  background-color: rgba(0,0,0,0.1);
}

#search-controls {
  display: flex;
  justify-content: center;
  gap: 10px;
}

#name-search {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #555;
  background-color: #222;
  color: #fff;
  width: 100%;
  max-width: 300px;
}

#clear-filters-btn {
  padding: 8px 16px;
  background-color: #c0392b; /* Rojo */
  color: #fff;
  margin-top: 0;
}
#clear-filters-btn:hover {
 box-shadow: 0 0 15px rgba(192, 57, 43, 0.6);
}

/* --- ESTILO PARA MENSAJE DE "SIN RESULTADOS" EN EL ÁLBUM --- */
.no-results-message {
  width: 100%;
  text-align: center;
  padding: 60px 20px;
  font-size: 20px;
  font-weight: bold;
  color: #888;
  background: rgba(0,0,0,0.1);
  border-radius: 12px;
  margin-top: 20px;
}

/* --- ESTILOS PARA EL CHECKBOX 'SHOW MISSING' --- */
#search-controls {
  align-items: center; /* Asegura que todo esté alineado verticalmente */
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px; /* Espacio entre el tick y el texto */
  color: #ccc;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none; /* Evita que el texto se seleccione al hacer clic */
}

.checkbox-label:hover {
  color: #fff;
}

#show-missing-checkbox {
  cursor: pointer;
  width: 16px;
  height: 16px;
  accent-color: #1f7; /* Cambia el color del tick para que coincida con el botón "Open Pack" */
}

/* Estilo para cuando el checkbox está deshabilitado */
#show-missing-checkbox:disabled {
  cursor: not-allowed;
}

#show-missing-checkbox:disabled + label, /* El texto también debe cambiar */
.checkbox-label[for="show-missing-checkbox-disabled"] { /* Si el label tiene el for correcto*/
  cursor: not-allowed;
  opacity: 0.5;
  color: #888;
}

/* Pequeño ajuste para que el botón de limpiar no esté tan pegado */
#clear-filters-btn {
  margin-left: 10px;
}

</style>
</head>
<body>
  <audio id="flipSound" src="sounds/flip-sound.mp3" preload="auto"></audio>
  <audio id="buttonClickSound" src="sounds/button-click.mp3" preload="auto"></audio>
  <h1><img src="images/Logo.png" alt="Football TCG Logo"></h1>
  <div class="button-container">
    <button onclick="openPack()">Open Pack</button>
    <button id="showcaseBtn">My Album</button>
    <button onclick="resetCollection()" style="background-color: #E6A115; color: #fff;">Reset Progress</button>
  </div>
  <div id="cards"></div>
  <div id="showcase-overlay">
    <!-- FILTROS Album -->
    <div id="showcase-filters-container">
      <div id="filter-controls">
        <!-- Los botones de filtro se generarán aquí con JavaScript -->
      </div>
      <div id="search-controls">
        <input type="text" id="name-search" placeholder="Search by name or position...">
        <label for="show-missing-checkbox" class="checkbox-label">
          <input type="checkbox" id="show-missing-checkbox">
          Show missing cards
        </label>
        <button id="clear-filters-btn">Clear All</button>
      </div>
    </div>
    <div id="showcase-content"></div>
    <button id="closeShowcaseBtn">X</button>
  </div>

  <div id="inspect-overlay"></div>

  <script>
    const TEST_MODE_FILL_ALBUM = false; /*PRUEBA ALBUM LLENO*/
    const ALLOW_GOLDEN_CARDS = true; /*DESHABILITAR DORADAS*/
    const playersDB = [
    /* RELIC (12 Jugadores) */
    { id: 1, name: "Lionel Messi", position: "ATK", rating: 99, rarity: "relic", img: "images/lionelmessi.png" },/*DONE*/
    { id: 2, name: "Pelé", position: "ATK", rating: 98, rarity: "relic", img: "images/pele.png" },/*DONE*/
    { id: 3, name: "Diego Maradona", position: "MID", rating: 97, rarity: "relic", img: "images/diegomaradona.png" },/*DONE*/
    { id: 4, name: "Cristiano Ronaldo", position: "ATK", rating: 95, rarity: "relic", img: "images/cristianoronaldo.png" },/*DONE*/
    { id: 5, name: "Johan Cruyff", position: "MID", rating: 97, rarity: "relic", img: "images/johancruyff.png" },/*DONE*/
    { id: 6, name: "Zinedine Zidane", position: "MID", rating: 95, rarity: "relic", img: "images/zinedinezidane.png" },/*DONE*/
    { id: 7, name: "Ronaldo Nazário", position: "ATK", rating: 95, rarity: "relic", img: "images/ronaldonazario.png" },/*DONE*/
    { id: 8, name: "Ronaldinho", position: "MID", rating: 96, rarity: "relic", img: "images/ronaldinho.png" },/*DONE*/
    { id: 9, name: "Andrés Iniesta", position: "MID", rating: 95, rarity: "relic", img: "images/andresiniesta.png" },/*DONE*/
    { id: 10, name: "Xavi Hernández", position: "MID", rating: 96, rarity: "relic", img: "images/xavihernandez.png" },/*DONE*/
    { id: 11, name: "Carles Puyol", position: "DEF", rating: 92, rarity: "relic", img: "images/carlespuyol.png" },/*DONE*/
    { id: 12, name: "Oliver Khan", position: "GK", rating: 92, rarity: "relic", img: "images/oliverkhan.png" },/*DONE*/

    /* LEGENDARY (16 Jugadores) */
    { id: 13, name: "Kylian Mbappé", position: "ATK", rating: 94, rarity: "legendary", img: "images/kylianmbappe.png" },/*DONE*/
    { id: 14, name: "Erling Haaland", position: "ATK", rating: 93, rarity: "legendary", img: "images/erlinghaaland.png" },/*DONE*/
    { id: 15, name: "Nemanja Vidic", position: "DEF", rating: 93, rarity: "legendary", img: "images/nemanjavidic.png" },/*DONE*/
    { id: 16, name: "Thierry Henry", position: "ATK", rating: 94, rarity: "legendary", img: "images/thierryhenry.png" },/*DONE*/
    { id: 17, name: "Kevin De Bruyne", position: "MID", rating: 92, rarity: "legendary", img: "images/kevindebruyne.png" },/*DONE*/
    { id: 18, name: "Hristo Stoichkov", position: "ATK", rating: 92, rarity: "legendary", img: "images/hristostoichkov.png" },/*DONE*/
    { id: 19, name: "Sergio Busquets", position: "MID", rating: 93, rarity: "legendary", img: "images/sergiobusquets.png" },/*DONE*/
    { id: 20, name: "Zlatan Ibrahimovic", position: "ATK", rating: 91, rarity: "legendary", img: "images/zlatanibrahimovic.png" },/*DONE*/
    { id: 21, name: "Neymar Jr.", position: "ATK", rating: 93, rarity: "legendary", img: "images/neymarjr.png" },/*DONE*/
    { id: 22, name: "Virgil van Dijk", position: "DEF", rating: 91, rarity: "legendary", img: "images/virgilvandijk.png" },/*DONE*/
    { id: 23, name: "Gennaro Gattuso", position: "MID", rating: 91, rarity: "legendary", img: "images/gennarogattuso.png" },/*DONE*/
    { id: 24, name: "Robert Lewandowski", position: "ATK", rating: 91, rarity: "legendary", img: "images/robertlewandowski.png" },/*DONE*/
    { id: 25, name: "Sergio Ramos", position: "DEF", rating: 90, rarity: "legendary", img: "images/sergioramos.png" },/*DONE*/
    { id: 26, name: "Thibaut Courtois", position: "GK", rating: 90, rarity: "legendary", img: "images/thibautcourtois.png" },/*DONE*/
    { id: 27, name: "Mohamed Salah", position: "ATK", rating: 91, rarity: "legendary", img: "images/mohamedsalah.png" },/*DONE*/
    { id: 28, name: "Paolo Maldini", position: "DEF", rating: 94, rarity: "legendary", img: "images/paolomaldini.png" },/*DONE*/
    { id: 54, name: "Lamine Yamal", position: "ATK", rating: 83, rarity: "legendary", img: "images/lamineyamal.png" },/*DONE*/

    /* EPIC (17 Jugadores) */
    { id: 29, name: "Jude Bellingham", position: "MID", rating: 88, rarity: "epic", img: "images/judebellingham.png" },/*DONE*/
    { id: 30, name: "Harry Kane", position: "ATK", rating: 90, rarity: "epic", img: "images/harrykane.png" },/*DONE*/
    { id: 31, name: "Rodri", position: "MID", rating: 89, rarity: "epic", img: "images/rodri.png" },/*DONE*/
    { id: 32, name: "Alisson Becker", position: "GK", rating: 89, rarity: "epic", img: "images/alissonbecker.png" },/*DONE*/
    { id: 33, name: "Pedri", position: "MID", rating: 90, rarity: "epic", img: "images/pedri.png" },/*DONE*/
    { id: 34, name: "Lautaro Martínez", position: "ATK", rating: 88, rarity: "epic", img: "images/lautaromartinez.png" },/*DONE*/
    { id: 35, name: "Bukayo Saka", position: "ATK", rating: 88, rarity: "epic", img: "images/bukayosaka.png" },/*DONE*/
    { id: 36, name: "Jamal Musiala", position: "MID", rating: 88, rarity: "epic", img: "images/jamalmusiala.png" },/*DONE*/
    { id: 37, name: "Julián Álvarez", position: "ATK", rating: 87, rarity: "epic", img: "images/julianalvarez.png" },/*DONE*/
    { id: 38, name: "Frenkie de Jong", position: "MID", rating: 89, rarity: "epic", img: "images/frenkiedejong.png" },/*DONE*/
    { id: 39, name: "William Saliba", position: "DEF", rating: 87, rarity: "epic", img: "images/williamsaliba.png" },/*DONE*/
    { id: 40, name: "Viktor Gyokeres", position: "ATK", rating: 87, rarity: "epic", img: "images/viktorgyokeres.png" },/*DONE*/
    { id: 41, name: "Rúben Dias", position: "DEF", rating: 87, rarity: "epic", img: "images/rubendias.png" },/*DONE*/
    { id: 42, name: "Son Heung-min", position: "ATK", rating: 87, rarity: "epic", img: "images/sonheungmin.png" },/*DONE*/
    { id: 43, name: "Gavi", position: "MID", rating: 86, rarity: "epic", img: "images/gavi.png" },/*DONE*/
    { id: 44, name: "Marc-André ter Stegen", position: "GK", rating: 86, rarity: "epic", img: "images/terstegen.png" },/*DONE*/
    { id: 45, name: "Joan Garcia", position: "GK", rating: 86, rarity: "epic", img: "images/joangarcia.png" },/*DONE*/

    /* RARE (18 Jugadores) */
    { id: 46, name: "Martin Ødegaard", position: "MID", rating: 85, rarity: "rare", img: "images/martinodegaard.png" },/*DONE*/
    { id: 47, name: "Declan Rice", position: "MID", rating: 85, rarity: "rare", img: "images/declanrice.png" },/*DONE*/
    { id: 48, name: "Eric Garcia", position: "DEF", rating: 85, rarity: "rare", img: "images/ericgarcia.png" },/*DONE*/
    { id: 49, name: "Jackson Irvine", position: "MID", rating: 85, rarity: "rare", img: "images/jacksonirvine.png" },/*DONE*/
    { id: 50, name: "Alexis Mac Allister", position: "MID", rating: 84, rarity: "rare", img: "images/alexismacallister.png" },/*DONE*/
    { id: 51, name: "Alejandro Grimaldo", position: "DEF", rating: 84, rarity: "rare", img: "images/alejandrogrimaldo.png" },/*DONE*/
    { id: 52, name: "Theo Hernández", position: "DEF", rating: 84, rarity: "rare", img: "images/theohernandez.png" },/*DONE*/
    { id: 53, name: "Takefusa Kubo", position: "ATK", rating: 83, rarity: "rare", img: "images/takefusakubo.png" },/*DONE*/
    { id: 55, name: "Darwin Núñez", position: "ATK", rating: 81, rarity: "rare", img: "images/darwinnunez.png" },/*DONE*/
    { id: 56, name: "Christopher Nkunku", position: "MID", rating: 82, rarity: "rare", img: "images/christophernkunku.png" },/*DONE*/
    { id: 57, name: "Unai Simón", position: "GK", rating: 81, rarity: "rare", img: "images/unaisimon.png" },/*DONE*/
    { id: 58, name: "Nicolò Barella", position: "MID", rating: 81, rarity: "rare", img: "images/nicolobarella.png" },/*DONE*/
    { id: 59, name: "Alexander Isak", position: "ATK", rating: 84, rarity: "rare", img: "images/alexanderisak.png" },/*DONE*/
    { id: 60, name: "Alphonso Davies", position: "DEF", rating: 81, rarity: "rare", img: "images/alphonsodavies.png" },/*DONE*/
    { id: 61, name: "Ollie Watkins", position: "ATK", rating: 81, rarity: "rare", img: "images/olliewatkins.png" },/*DONE*/
    { id: 62, name: "Mikel Merino", position: "MID", rating: 81, rarity: "rare", img: "images/mikelmerino.png" },/*DONE*/
    { id: 63, name: "Federico Chiesa", position: "ATK", rating: 81, rarity: "rare", img: "images/federicochiesa.png" },/*DONE*/

    /* COMMON (25 Jugadores) */
    { id: 64, name: "Enzo Fernández", position: "MID", rating: 82, rarity: "common", img: "images/enzofernandez.png" },/*DONE*/
    { id: 65, name: "Josko Gvardiol", position: "DEF", rating: 82, rarity: "common", img: "images/joskogvardiol.png" },/*DONE*/
    { id: 66, name: "Bruno Guimarães", position: "MID", rating: 82, rarity: "common", img: "images/brunoguimaraes.png" },/*DONE*/
      { id: 67, name: "Dominik Szoboszlai", position: "MID", rating: 82, rarity: "common", img: "images/dominikszoboszlai.png" },
    { id: 68, name: "Lisandro Martínez", position: "DEF", rating: 82, rarity: "common", img: "images/lisandromartinez.png" },/*DONE*/
    { id: 69, name: "Pau Torres", position: "DEF", rating: 81, rarity: "common", img: "images/pautorres.png" },/*DONE*/
    { id: 70, name: "Lucas Paquetá", position: "MID", rating: 81, rarity: "common", img: "images/lucaspaqueta.png" },/*DONE*/
    { id: 71, name: "Nico Williams", position: "ATK", rating: 80, rarity: "common", img: "images/nicowilliams.png" },/*DONE*/
    { id: 72, name: "André Onana", position: "GK", rating: 78, rarity: "common", img: "images/andreonana.png" },/*DONE*/
    { id: 73, name: "Iñaki Williams", position: "ATK", rating: 78, rarity: "common", img: "images/inakiwilliams.png" },/*DONE*/
    { id: 74, name: "João Palhinha", position: "MID", rating: 80, rarity: "common", img: "images/joaopalhinha.png" },/*DONE*/
    { id: 75, name: "Jeremie Frimpong", position: "DEF", rating: 80, rarity: "common", img: "images/jeremiefrimpong.png" },/*DONE*/
    { id: 76, name: "Sandro Tonali", position: "MID", rating: 80, rarity: "common", img: "images/sandrotonali.png" },/*DONE*/
    { id: 77, name: "Ferran Jutgla", position: "ATK", rating: 79, rarity: "common", img: "images/ferranjutgla.png" },/*DONE*/
    { id: 78, name: "Moisés Caicedo", position: "MID", rating: 79, rarity: "common", img: "images/moisescaicedo.png" },/*DONE*/
    { id: 79, name: "Pau Cubarsí", position: "DEF", rating: 81, rarity: "common", img: "images/paucubarsi.png" },/*DONE*/
    { id: 80, name: "Kaoru Mitoma", position: "ATK", rating: 79, rarity: "common", img: "images/kaorumitoma.png" },/*DONE*/
    { id: 81, name: "Guido Rodríguez", position: "MID", rating: 79, rarity: "common", img: "images/guidorodriguez.png" },/*DONE*/
    { id: 82, name: "Álex Baena", position: "MID", rating: 78, rarity: "common", img: "images/alexbaena.png" },/*DONE*/
    { id: 83, name: "Conor Gallagher", position: "MID", rating: 78, rarity: "common", img: "images/conorgallagher.png" },/*DONE*/
    { id: 84, name: "Manuel Ugarte", position: "MID", rating: 78, rarity: "common", img: "images/manuelugarte.png" },/*DONE*/
    { id: 85, name: "Giorgi Mamardashvili", position: "GK", rating: 78, rarity: "common", img: "images/mamardashvili.png" },/*DONE*/
    { id: 86, name: "Santiago Giménez", position: "ATK", rating: 78, rarity: "common", img: "images/santiagogimenez.png" },/*DONE*/
    { id: 87, name: "Alejandro Balde", position: "DEF", rating: 80, rarity: "common", img: "images/alejandrobalde.png" },/*DONE*/
    { id: 88, name: "Anthony Gordon", position: "ATK", rating: 77, rarity: "common", img: "images/anthonygordon.png" }/*DONE*/
    ];

    const CONFIG = {
      packSize: 11,
      rarities: { common: { p: 69.5, p_golden: 1.5, order: 1 }, rare: { p: 21.2, p_golden: 1.1, order: 2 }, epic: { p: 4.2,  p_golden: 0.6, order: 3 }, legendary: { p: 0.8,  p_golden: 0.3, order: 4 }, relic: { p: 0.5,  p_golden: 0.1, order: 5 }, },
      variants: { none: {p:0}, foil: { p: 1.1 }, holo: { p: 0.6 }, poli: { p: 0.3 }, negative: { p: 0.1 }, },
      goldenChance: 3.8,
    };

    function buildProbLists(config) {
      const regularProbs = []; const goldenRaw = [];
      for (const key in config.rarities) { regularProbs.push({ r: key, p: config.rarities[key].p }); goldenRaw.push({ r: key, p: config.rarities[key].p_golden }); }
        const goldenTotalRaw = goldenRaw.reduce((s, x) => s + x.p, 0); const goldenScale = config.goldenChance / goldenTotalRaw;
      const goldenProbs = goldenRaw.map(x => ({ r: x.r, p: x.p * goldenScale }));
      const variantProbs = Object.entries(config.variants).filter(([k,v])=> k !== 'none').map(([key, value]) => ({ v: key, p: value.p }));
      return { regularProbs, goldenProbs, variantProbs };
    }

    const { regularProbs, goldenProbs, variantProbs } = buildProbLists(CONFIG);

    // 1. Intentamos cargar la colección guardada desde localStorage.
    const savedCollection = localStorage.getItem('myFootballCollection');
    
    // 2. Si había algo guardado, lo convertimos de texto a objeto.
    //    Si no había nada (la primera vez que se visita), empezamos con una colección vacía.
    let collection = savedCollection ? JSON.parse(savedCollection) : {};

    // --- NUEVAS VARIABLES GLOBALES PARA FILTROS ---
    let activeFilters = {
      rarity: null,
      variant: null,
      golden: null,
      query: '',
      showMissing: false
    };
    let filtersInitialized = false;

    let flippedCardsInPack = 0;
    const openPackBtn = document.querySelector('button[onclick="openPack()"]');

    let counters = {};
    for (const rarityKey in CONFIG.rarities) {
      counters[rarityKey] = {};
      for (const variantKey in CONFIG.variants) {
        counters[rarityKey][variantKey] = { normal: 0, golden: 0 };
      }
    }

    function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

    function pickByProb(list) {
      const totalProb = list.reduce((sum, item) => sum + item.p, 0); const roll = Math.random() * totalProb;
      let acc = 0;
      for (const item of list) { acc += item.p; if (roll < acc) return item; }
        return list[list.length - 1];
    }

    function generateCard() {
      const isGolden = ALLOW_GOLDEN_CARDS && (Math.random() * 100) < CONFIG.goldenChance;
      const rarity = isGolden ? pickByProb(goldenProbs).r : pickByProb(regularProbs).r;
      const totalVariantChance = Object.values(CONFIG.variants).reduce((s, v) => s + v.p, 0);
      const variant = (Math.random() * 100 < totalVariantChance) ? pickByProb(variantProbs).v : 'none';
      const playersOfRarity = playersDB.filter(p => p.rarity === rarity);
      const player = playersOfRarity[Math.floor(Math.random() * playersOfRarity.length)];
      return { playerData: player, rarity, golden: isGolden, variant };
    }

    function openPack() {
      openPackBtn.disabled = true; // Desactiva el botón
  flippedCardsInPack = 0;      // Reinicia el contador
  const container = document.getElementById("cards");
  container.innerHTML = "";
  let pack = [];
  for (let i = 0; i < CONFIG.packSize; i++) { 
    pack.push(generateCard());
  }

  if (!pack.some(c => CONFIG.rarities[c.rarity].order > 1)) {
    const rarePlayers = playersDB.filter(p => p.rarity === 'rare');
    pack[0] = { ...generateCard(), rarity: 'rare', playerData: rarePlayers[Math.floor(Math.random() * rarePlayers.length)] };
  }
  pack.sort((a, b) => CONFIG.rarities[a.rarity].order - CONFIG.rarities[b.rarity].order);

  pack.forEach((cardObj, i) => {
    const div = document.createElement("div");
    const variantClass = cardObj.variant !== 'none' ? `variant-${cardObj.variant}` : '';
    div.className = `card ${cardObj.rarity} ${cardObj.golden ? 'golden' : ''} ${variantClass}`;
    div.style.zIndex = pack.length - i;
    div.dataset.rarity = cardObj.rarity;
    div.dataset.golden = cardObj.golden;
    div.dataset.variant = cardObj.variant;
    div.dataset.index = i;
    div.style.transform = `translateX(${i * 2}px) translateY(${i * -2}px)`;

    const indicatorsHTML = `<div class="card-indicators">${cardObj.variant !== 'none' ? `<div class="indicator">${cardObj.variant.charAt(0).toUpperCase()}</div>` : ''}</div>`;

    div.innerHTML = `
          <div class="side front">
            <img src="${cardObj.playerData.img}" class="player-image" alt="${cardObj.playerData.name}" />
            ${indicatorsHTML}
            <div class="player-info">
            </div>
          </div>
          <div class="side back">⚽</div>
    `;
    div.cardData = cardObj;
    div.onclick = () => flipCard(div, i);
    container.appendChild(div);
  });
}

/*esto va en player-info por si acaso el de arriba ye en createShowcase (album)


              <div class="player-rating">${cardObj.playerData.rating}</div>
              <div class="player-position">${cardObj.playerData.position}</div>

*/

function flipCard(card, index) {
 if (card.classList.contains("flipped")) return;
 flippedCardsInPack++;
 if (flippedCardsInPack === CONFIG.packSize) {
  openPackBtn.disabled = false;
}

const flipSound = document.getElementById('flipSound');
if (flipSound) {
  flipSound.currentTime = 0;
  flipSound.volume = 0.25;
  flipSound.play();
}

const cardObj = card.cardData;
const playerId = cardObj.playerData.id;
const variantKey = `${cardObj.golden}_${cardObj.variant}`;
const isNewVariant = !collection[playerId]?.[variantKey];

if (isNewVariant) {
  const newIndicator = document.createElement('div');
  newIndicator.className = 'new-indicator';
  newIndicator.textContent = 'NEW';
  card.appendChild(newIndicator);
  setTimeout(() => {
    newIndicator.remove();
  }, 4200);
}

if (!collection[playerId]) {
  collection[playerId] = {};
}
if (!collection[playerId][variantKey]) {
  collection[playerId][variantKey] = { count: 1, cardData: cardObj };
} else {
  collection[playerId][variantKey].count++;
}

localStorage.setItem('myFootballCollection', JSON.stringify(collection));

const rarity = card.dataset.rarity;
const isGolden = card.dataset.golden === "true";
const variant = card.dataset.variant;

card.style.transition = 'transform 0.7s ease, left 0.7s ease, top 0.7s ease';
card.classList.add("flipped", "is-animating"); 

setTimeout(() => {
  card.classList.remove("is-animating");
  card.style.transition = '';
  addInteractiveTilt(card);
}, 700);

if (isGolden) {
  counters[rarity][variant].golden++;
} else {
  counters[rarity][variant].normal++;
}

const containerWidth = Math.min(window.innerWidth * 0.95, 1540);
const cardSpacing = containerWidth / CONFIG.packSize;
const spread = (containerWidth - cardSpacing) / 2;

card.style.left = `${-spread + index * cardSpacing}px`;
card.style.top = `calc(var(--card-h) + 30px)`;
card.style.transform = 'rotateY(180deg)';

addReactiveEffects(card);
}

function updateCounter() {
  for (const rarityKey in counters) {
    for (const variantKey in counters[rarityKey]) {
      const capRarity = capitalize(rarityKey);
      const capVariant = capitalize(variantKey);

      const normalId = `c${capRarity}${capVariant}`;
      const goldenId = `cg${capRarity}${capVariant}`;

      if(document.getElementById(normalId)) {
        document.getElementById(normalId).textContent = counters[rarityKey][variantKey].normal;
      }
      if(document.getElementById(goldenId)) {
        document.getElementById(goldenId).textContent = counters[rarityKey][variantKey].golden;
      }
    }
  }
}

function createShowcase() {
  const container = document.getElementById('showcase-content');
  container.innerHTML = '';
  const query = activeFilters.query.toLowerCase().trim();

  const isFiltering = activeFilters.rarity || activeFilters.variant || activeFilters.golden !== null || query !== '';
  
  // --- CAMBIO CLAVE: movemos esta variable aquí arriba ---
  // Ahora también registrará si se muestra algún HUECO, no solo cartas poseídas.
  let anyContentWasDisplayed = false; 

  const raritiesInOrder = Object.keys(CONFIG.rarities).sort((a, b) => CONFIG.rarities[a].order - CONFIG.rarities[b].order);
  const variantKeys = Object.keys(CONFIG.variants);

  raritiesInOrder.forEach(rarityKey => {
    if (activeFilters.rarity && activeFilters.rarity !== rarityKey) {
      return;
    }

    const playersInRarity = playersDB.filter(p => p.rarity === rarityKey);
    if (playersInRarity.length === 0) return;

    const row = document.createElement('div');
    row.className = 'showcase-row';
    const grid = document.createElement('div');
    grid.className = 'showcase-grid';
    
    let rowHasVisiblePlayers = false;

    playersInRarity.forEach(player => {
      if (query && !player.name.toLowerCase().includes(query) && !player.position.toLowerCase().includes(query)) {
        return;
      }

      const playerEntry = document.createElement('div');
      playerEntry.className = 'player-album-entry';
      const variantsGrid = document.createElement('div');
      variantsGrid.className = 'variants-grid';
      
      let playerHasVisibleSlots = false;

      for (const isGolden of [false, true]) {
        if (activeFilters.golden !== null && isGolden !== activeFilters.golden) continue;

        for (const variantKey of variantKeys) {
          if (activeFilters.variant && variantKey !== activeFilters.variant) continue;
          
          const lookupKey = `${isGolden}_${variantKey}`;
          const collectedVersion = collection[player.id]?.[lookupKey];

          if (collectedVersion) {
            playerHasVisibleSlots = true;
            anyContentWasDisplayed = true; // Marcamos que se ha mostrado contenido.

            const { cardData, count } = collectedVersion;
            const div = document.createElement("div");
            const variantClass = cardData.variant !== 'none' ? `variant-${cardData.variant}` : '';
            div.className = `card showcase-card flipped ${cardData.rarity} ${cardData.golden ? 'golden' : ''} ${variantClass}`;
            const indicatorsHTML = `<div class="card-indicators">${cardData.variant !== 'none' ? `<div class="indicator">${cardData.variant.charAt(0).toUpperCase()}</div>` : ''}</div>`;
            const duplicateCounterHTML = count > 1 ? `<div class="duplicate-counter">x${count}</div>` : '';

            div.innerHTML = `
              <div class="side front">
                <img src="${cardData.playerData.img}" class="player-image" alt="${cardData.playerData.name}" />
                ${indicatorsHTML}
                ${duplicateCounterHTML}
                <div class="player-info"></div>
            </div>`;
            variantsGrid.appendChild(div);
            addInteractiveTilt(div);
            addReactiveEffects(div);
            div.addEventListener('click', () => showInspectView(div));

          } else if (!isFiltering || (isFiltering && activeFilters.showMissing)) {
            playerHasVisibleSlots = true;
            anyContentWasDisplayed = true; // Marcamos que se ha mostrado contenido (un hueco).

            const placeholder = document.createElement('div');
            placeholder.className = 'card showcase-card album-placeholder';
            const phIndicators = `
              <div class="placeholder-indicators">
                ${isGolden ? '<div class="placeholder-indicator golden-indicator">Golden</div>' : ''}
              ${variantKey !== 'none' ? `<div class="placeholder-indicator">${capitalize(variantKey)}</div>` : ''}
            </div>`;
            placeholder.innerHTML = phIndicators;
            variantsGrid.appendChild(placeholder);
          }
        }
      }
      
      if (playerHasVisibleSlots) {
        rowHasVisiblePlayers = true;
        playerEntry.innerHTML = `<h3>${player.name}</h3>`;
        playerEntry.appendChild(variantsGrid);
        grid.appendChild(playerEntry);
      }
    });
    
    if (rowHasVisiblePlayers) {
      row.innerHTML = `<h2>${capitalize(rarityKey)}</h2>`;
      row.appendChild(grid);
      container.appendChild(row);
    }
  });

  // --- LÓGICA FINAL MODIFICADA ---
  // Ahora, solo mostramos el mensaje si se estaba filtrando Y no se mostró NINGÚN contenido (ni cartas ni huecos).
  if (isFiltering && !anyContentWasDisplayed) {
    container.innerHTML = `<div class="no-results-message">You don't have any cards with that combination.</div>`;
  }
}

const showcaseOverlay = document.getElementById('showcase-overlay');
const showcaseBtn = document.getElementById('showcaseBtn');
const closeShowcaseBtn = document.getElementById('closeShowcaseBtn');

showcaseBtn.addEventListener('click', () => {
  buildFilterUI(); // Construye los botones de filtro la primera vez
  createShowcase(); // Renderiza el álbum (ya filtrado si hay filtros activos)
  showcaseOverlay.classList.add('visible');
});

closeShowcaseBtn.addEventListener('click', () => {
  showcaseOverlay.classList.remove('visible');
});

showcaseOverlay.addEventListener('click', (e) => {
  if (e.target === showcaseOverlay) {
    showcaseOverlay.classList.remove('visible');
  }
});

// --- NUEVOS LISTENERS PARA LOS FILTROS ---
document.addEventListener('DOMContentLoaded', () => {
  const showMissingCheckbox = document.getElementById('show-missing-checkbox');
  const showMissingLabel = document.querySelector('.checkbox-label[for="show-missing-checkbox"]');

  // Delegación de eventos para los botones de filtro
  const filterControls = document.getElementById('filter-controls');
  if(filterControls) {
    filterControls.addEventListener('click', (e) => {
      handleFilterClick(e);
      updateFilterUI(); // Llama a la actualización de UI aquí
    });
  }

  // Listener para la barra de búsqueda
  const searchInput = document.getElementById('name-search');
  if(searchInput) {
    searchInput.addEventListener('input', (e) => {
      activeFilters.query = e.target.value;
      updateFilterUI(); // Actualiza la UI de filtros
      createShowcase();
    });
  }

  // Listener para el nuevo checkbox
  if(showMissingCheckbox) {
    showMissingCheckbox.addEventListener('change', () => {
      activeFilters.showMissing = showMissingCheckbox.checked;
          createShowcase(); // Re-renderiza el álbum
        });
  }

  // Listener para el botón de limpiar filtros (MODIFICADO)
  const clearBtn = document.getElementById('clear-filters-btn');
  if(clearBtn) {
    clearBtn.addEventListener('click', () => {
      const buttonSound = document.getElementById('buttonClickSound');
      if (buttonSound) {
        buttonSound.currentTime = 0;
        buttonSound.play();
      }
      // Resetea todos los filtros, incluyendo el nuevo
      activeFilters = { rarity: null, variant: null, golden: null, query: '', showMissing: false };
      searchInput.value = '';
      showMissingCheckbox.checked = false; // Asegúrate de desmarcar el checkbox visualmente
      updateFilterUI();
      createShowcase();
    });
  }
});

function addInteractiveTilt(cardElement) {
  cardElement.addEventListener("mousemove", (e) => {
    if (cardElement.classList.contains('is-animating')) {
      return;
    }

    const rect = cardElement.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const rotateX = ((y / rect.height) - 0.5) * 40; 
    const rotateY = ((x / rect.width) - 0.5) * 40;

    // --- LÓGICA CORREGIDA ---
    // Determinamos si la carta está siendo inspeccionada
    const isInspecting = cardElement.closest('#inspect-overlay');
    // El escalado depende de dónde está la carta
    const scale = isInspecting ? 1.1 : 1.25;

    cardElement.classList.add('tilting');
    // Aplicamos TODA la transformación junta en una sola línea
    cardElement.style.transform = `rotateY(180deg) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(${scale})`;
    cardElement.style.zIndex = '999'; 
  });

  cardElement.addEventListener("mouseleave", () => {
    cardElement.classList.remove('tilting');
    // Al salir, volvemos a la transformación base (solo volteada)
    cardElement.style.transform = "rotateY(180deg)";
    cardElement.style.zIndex = '';
  });
}

function addReactiveEffects(cardElement) {
  if (!cardElement.classList.contains('flipped')) return;

  cardElement.addEventListener('mousemove', (e) => {
    const bounds = cardElement.getBoundingClientRect();
    const mouseX = e.clientX - bounds.left;
    const mouseY = e.clientY - bounds.top;
    const centerX = bounds.width / 2;
    const centerY = bounds.height / 2;
    
    const posX = (mouseY - centerY) * -0.12;
    const posY = (mouseX - centerX) * 0.12;

    cardElement.style.setProperty('--x', posX);
    cardElement.style.setProperty('--y', posY);
  });

  cardElement.addEventListener('mouseleave', () => {
    cardElement.style.setProperty('--x', 0);
    cardElement.style.setProperty('--y', 0);
  });
}

function resetCollection() {
  // Preguntamos para evitar clics accidentales
  if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
    // Borramos los datos del localStorage
    localStorage.removeItem('myFootballCollection');
    // Recargamos la página para que se apliquen los cambios
    location.reload();
  }
}

function buildFilterUI() {
    if (filtersInitialized) return; // Evita crear los botones múltiples veces

    const container = document.getElementById('filter-controls');
    container.innerHTML = ''; // Limpiamos por si acaso

    // Botones de Rareza
    Object.keys(CONFIG.rarities).sort((a, b) => CONFIG.rarities[a].order - CONFIG.rarities[b].order).forEach(rarity => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn rarity-filter';
      btn.dataset.filterType = 'rarity';
      btn.dataset.filterValue = rarity;
      btn.innerHTML = `${capitalize(rarity)} <span class="diamond">♦</span>`;
      container.appendChild(btn);
    });

    // Botones de Variante
    Object.keys(CONFIG.variants).filter(v => v !== 'none').forEach(variant => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn variant-filter';
      btn.dataset.filterType = 'variant';
      btn.dataset.filterValue = variant;
      btn.textContent = capitalize(variant);
      container.appendChild(btn);
    });

    // Botón Golden
    const goldenBtn = document.createElement('button');
    goldenBtn.className = 'filter-btn';
    goldenBtn.dataset.filterType = 'golden';
    goldenBtn.dataset.filterValue = 'golden';
    goldenBtn.textContent = 'Golden';
    container.appendChild(goldenBtn);

    filtersInitialized = true;
  }

  function handleFilterClick(e) {
    const btn = e.target.closest('.filter-btn');
    if (!btn) return;

    const buttonSound = document.getElementById('buttonClickSound');
    if (buttonSound) {
      buttonSound.currentTime = 0;
      buttonSound.play();
    }

    const { filterType, filterValue } = btn.dataset;

    // Si el botón ya está activo, lo desactivamos. Si no, lo activamos.
    if (btn.classList.contains('active')) {
      activeFilters[filterType] = null;
    } else {
      activeFilters[filterType] = filterType === 'golden' ? true : filterValue;
    }

    updateFilterUI();
    createShowcase(); // Volvemos a renderizar el álbum con los filtros aplicados
  }

  function updateFilterUI() {
    const showMissingCheckbox = document.getElementById('show-missing-checkbox');
    const isFiltering = 
    activeFilters.rarity !== null || 
    activeFilters.variant !== null || 
    activeFilters.golden === true || 
    activeFilters.query.trim() !== '';

    if (showMissingCheckbox) {
      showMissingCheckbox.disabled = !isFiltering;

      if (!isFiltering) {
        showMissingCheckbox.checked = false;
        activeFilters.showMissing = false;
      }
    }

    const rarityBtns = document.querySelectorAll('.rarity-filter');
    rarityBtns.forEach(btn => {
      const value = btn.dataset.filterValue;
      btn.classList.toggle('active', activeFilters.rarity === value);
      btn.disabled = activeFilters.rarity !== null && activeFilters.rarity !== value;
    });

    const variantBtns = document.querySelectorAll('.variant-filter');
    variantBtns.forEach(btn => {
      const value = btn.dataset.filterValue;
      btn.classList.toggle('active', activeFilters.variant === value);
      btn.disabled = activeFilters.variant !== null && activeFilters.variant !== value;
    });
    
    const goldenBtn = document.querySelector('.filter-btn[data-filter-type="golden"]');
    if (goldenBtn) {
      goldenBtn.classList.toggle('active', activeFilters.golden === true);
    }
  }

// Sonido botones
  const buttonSound = document.getElementById('buttonClickSound');
  const allButtons = document.querySelectorAll('button');

  allButtons.forEach(button => {
    button.addEventListener('click', () => {
      if (buttonSound) {
        buttonSound.currentTime = 0;
        buttonSound.play();
      }
    });
  });

// --- NUEVO CÓDIGO PARA GIRAR CARTAS CON LA BARRA ESPACIADORA ---
  document.addEventListener('keydown', (event) => {
  // Solo reaccionamos si la tecla presionada es la barra espaciadora
  // y si el álbum no está abierto.
    if (event.code === 'Space' && !showcaseOverlay.classList.contains('visible')) {
    // Prevenimos la acción por defecto de la barra espaciadora (hacer scroll)
      event.preventDefault();

    // Buscamos la primera carta en el mazo que todavía no haya sido girada
      const nextCardToFlip = document.querySelector('#cards .card:not(.flipped)');

    // Si encontramos una carta sin girar...
      if (nextCardToFlip) {
      // Obtenemos su índice, que guardamos previamente en el 'data-attribute'
        const cardIndex = parseInt(nextCardToFlip.dataset.index, 10);
        
      // Llamamos a la misma función que usa el clic para girarla
        flipCard(nextCardToFlip, cardIndex);
      }
    }
  });

// --- NUEVA LÓGICA PARA INSPECCIONAR CARTAS ---

  const inspectOverlay = document.getElementById('inspect-overlay');

  function showInspectView(originalCard) {
  // 1. Limpiamos cualquier contenido previo
    inspectOverlay.innerHTML = '';

  // 2. Clonamos la carta que se ha clickeado. 'true' copia todos sus hijos.
    const cardClone = originalCard.cloneNode(true);

  // 3. Es CRUCIAL volver a añadir los listeners interactivos al clon
    addInteractiveTilt(cardClone);
    addReactiveEffects(cardClone);
    
  // 4. Añadimos el clon al overlay
    inspectOverlay.appendChild(cardClone);

  // 5. Hacemos visible el overlay con una transición suave
    inspectOverlay.classList.add('visible');
  }

// Listener para cerrar el overlay
  inspectOverlay.addEventListener('click', (event) => {
  // Nos aseguramos de cerrar solo si se hace clic en el fondo (el overlay en sí),
  // y no en la carta que está dentro.
    if (event.target === inspectOverlay) {
      inspectOverlay.classList.remove('visible');
    }
  });

  openPack();

</script>
</body>
</html>
